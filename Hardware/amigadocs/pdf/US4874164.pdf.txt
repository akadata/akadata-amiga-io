United States Patent (19)                                                         11 Patent Number:                          4,874,164
Miner et al.                                                                      45) Date of Patent:                      Oct. 17, 1989
(54) PERSONAL COMPUTER APPARATUS FOR                                        puting, vol. 11, No. 9, pp. 32-41 by John J. Anderson,
       BLOCK TRANSFER OF BTMAPPED                                           Sep. 1985.
        MAGE DATA                                                           "What Makes. It So Great?' Creative Computing, vol.
75 Inventors: Jay G. Miner, Mtn. View; Dave                                 11, No. 9, pp. 34-40, by Sheldon Leemon, Sep. 1985.
              Dean, Ukiah; Joseph C. Decuir,
              Albany; Ronald H. Nicholson,                                  Primary Examiner-Maryann Lastova
              Sunnyvale; Akio Tanaka,                                       Attorney, Agent, or Firm-Finnegan, Henderson,
                      Burlingame, all of                                    Farabow, Garrett & Dunner
73 Assignee: Commodore-Amiga, Inc., Los Gatos,
                      Calif.                                                 57                                 ABSTRACT
21 Appl. No.: 886,796                                                       A computer that provides data to a video display using
22 Filed:     Jul.18, 1986                                                  a bitmap display memory organization and bitplane
                                                                            addressing. Separate control is provided for two bit
51) Int. Cl* ................................................ A63F 9/22     plane backgrounds and for eight reusable and easily
52 U.S. C. ........................... 273/1 E; 273/DIG. 28;                movable sprites. Additional logic allows for dynamical
                                                              340/720       ly-controllable interobject priority and collision detec
58 Field of Search ............ 273/1 E, DIG. 28, 85 G;                     tion among data in each of the bitplane backgrounds
                                                          340/720-725       and sprites. A coprocessor provides for video beam
56                      References Cited                                    synchronized changes to data in registers, freeing the
             U.S. PATENT DOCUMENTS                                          main processor for general purpose computing tasks. A
                                                                            block image transfer is provided to rapidly copy data in
     4,126,893 1/1978 Cronshaw et al. .                                     large blocks from one memory location to another. In
     4,296,476 10/1981 Mayer et al. .                                       hold-and-modify mode, color output circuitry holds the
     4,435,776 3/1984 Ratcliffe et al. .
     4,445,187 4/1984 Best .                                                value for a previously displayed pixel while bitplane
     4,509,043 4/1985 Mossaides ........................... 340/721         data modifies those values, allowing for simultaneous
     4,570,217 2/1986 Allen et al. ......................... 364/900        display of a greatly increased number of colors.
                OTHER PUBLICATIONS
"Amiga: The Message is the Medium,” Creative Com                                                    32 Claims, 4 Drawing Sheets



                                        DATAS



                                                                                           6



                                                                                                    S
                                                                          SEESHIFTER(32Bip-8
                                                                          (BTER            SBS
                                                                          CONR)

                                                                 s
                                                SE ESHIFTER (32BT)
                                                 M
                                                             52BE


                                                FCARRYIN                  all
                                                                          iyyyyyyyy
                                                                                               FL        Fl
                                                                                                        CARRY
                                                                                  as   X       TO

                                                 FENABLE
                                                   STORE TO
                                                 DESTNATION




                                             DATABUS
                                       404
U.S. Patent   Oct. 17, 1989   Sheet 1 of 11   4,874,164




                                                 (91)S0}}
U.S. Patent Oct. 17, 1989                      Sheet 2 of 11           4,874,164

                                        A/6 2.
 DATABUS

             83\ry
                MASK        NEW
                                        LW
                                       MASK                     NEW
                                                                      ?' 39 HOLD
        90                                6                       6


                           VAND    VAND                    79a-N B
                               CENTER                           OLD
                               WORDS                                           6


                                               (BLTTER
                                                CONTROL)
                            OLD                                           D                9
          93           8                                                  6           6

                           SHIFTER32BDJ MINTERMENERATOR (ALMNTERMS PRODUCED)
                               6 BTS          ABC ABC ABC ABC ABC ABC ABC ABC
          MULT-MNTERM                         EE-E-E-E-
         SELECT BITS (8)                                              P
          FLL CARRY IN
                                                              N
                                                                                    FL
                                                                      CARRY        CARRY
                                                                       OUT          OUT
                                                                       (TO          (TO
                                                                      NEXT         NEXT
             FLLENABLE                                                BLOCK)       WORD)
             STORE TO
           DESTINATION                                                               O7
        BLTTER CONTROL
                                                                 D -3
                                                               HOLD

       DATABUS
 404
U.S. Patent Oct. 17, 1989                            Sheet 3 of 11           4,874,164
                                        PRIORITY
                                        CONTROL          73
                                         LOGIC
          A/6 3.
                                                         SPRITE VERT.   39
                                                           POSITION
                                                         COMPARATOR



                       LIGHT             SYNCH
    LIGHTPEN            PEN
                        REG.
                                       VIDEO BEAM
                                          CTR.
          404                  (ENABLE)
                                  29




                  POINTER
                 REGISTERS
                      38




                                                                                PMA,
                                                                             CONTROL
                                                                              up was a   mo an   J




               BSP-            SO
                               (6)
                                                              REGISTER
                                                              ADDRESS - -27
        wa-a-a-Ha Non-alam-wnwa?                    29
                                                              DECODER
                                                              --- ---


      125-f        2       4, f2                    NHBTGATESIGNAL
         AUDIO         12 BIT BIT
                         MAP PLANE
               COPROCESSOR                               33
U.S. Patent                       Oct. 17, 1989   Sheet 8 of 11   4,874,164




           999
                 (9)S08E||8NWId
 O/39 -/
U.S. Patent        Oct. 17, 1989            Sheet 10 of 11            4,874,164
                                   A/6 /2.
                              COLLISION DETECTION LOGC 335


   SPRs us            -De-H
                        | | | | |
                      -Do-H
                        372


  BIT PLANE BUS
       333            -DOH
                             372
                             372
                                                                373          353
                  6BITS-LINES               373
                                                A                375 -----
             COLLISION N35                                      Do
  E--of
      REG. (16)                                     ||          Do
                                                                      | COLLISION
                                                                P. "SE
                                      || ||s".(16
                                                                Do     --




                                                         Y315
U.S. Patent Oct. 17, 1989                     Sheet 11 of 11   4,874,164




                                    3             s


                                        DO
                                    N
                                    N


                                        Do


                      go                so                        g
                 s    No.
                                    /Vo o         caus
                                                s
                                                n-gs
                                        2
                                                  S
          Home1a-ma-e-en-               -
          cu?               clf
          O                     O       Se,
           s                c
                 o
                 S.
                 no
                             en
                            an)
            d                Ind
          C-                C
          clfo
                                                       4,874,164
                            1.                                                          2
                                                              the second microprocessor is dedicated to video display
    PERSONAL COMPUTER APPARATUS FOR                           information retrieval.
   BLOCK TRANSFER OF BIT-MAPPED IMAGE                            Other early game circuits, such as Dash et al., U.S.
                          DATA                                Pat. No. 4,034,983 utilized special purpose control cir
                                                              cuits to generate signals to the antenna connection of a
      BACKGROUND OF THE INVENTION                             commercial color television receiver. Such a special
   This invention relates to the field of microprocessor purpose control circuit could include analog interface
powered computers for video games and personal com circuits for processing game-paddle signals and decod
puters, incorporating DMA techniques, especially such ing functions, and sync pulse generation could be used
systems which are implemented in MOS (metal oxide 10 to generate horizontal sync and raster scan information.
semiconductor) LSI (large scale integrated) circuitry          Personal computer and microprocessor driven sys
where circuit area is a consideration. The invention        tems, such as Chung, U.S. Pat. No. 4,177,462, have used
further relates to enhanced systems where auxiliary display generator circuitry driven off of an address bus,
circuitry has been added to the host system; where a 15 data bus and control bus, including raster line genera
television-type display device is used; and where bit tion and vertical position counters.
map mode (at least one bit of video information is stored      Likewise, Sukonick et al., U.S. Pat. No. 4,070,710
in memory for every element location (pixel) of the discloses incorporating video control circuits and raster
picture displayed) is likewise incorporated.                memory access into a system with data and address bus
  The invention also relates to video display drives for 20 architecture. Sukonicket al. discloses a video control
color video display monitors where color sprites              circuit which relies upon a plurality of vertical and
(which are sometimes                                       horizontal position registers, a skip pattern memory and
   Bit mapping, while space and time implementation modulo comparison circuitry for “FIFO’ processing of
consuming, has proven to be a straightforward and an video information.
accurate method for video display generation. Complex        Sukonicket al., U.S. Pat. No. 4,070,710, shows a two
displays provided by video games and personal comput 25 processor
ers require overlay presentations of movable and/or system 16 system. to his
                                                                               Sukonick et al. has added a display
                                                                              programmed     host computer 10. This
changeable information and offixed information; and of video display system 16 contains
collisions between movable objects. Bit map implemen 8088 microprocessor 76 within the an          Intel Corporation
                                                                                                micro-control unit of
tation has been the focus of various prior circuits.       the video display  system.
  Prior video game circuits have provided a complex     30
                                                             Along this line Burson, U.S. Pat. No. 4,180,805, has
display format to a television receiver display unit (a provided     a video display circuit which incorporates a
cathode ray tube), which display unit generates the general purpose          microprocessor 15, the TMS 1100 mi
presentation with a plurality of horizontal scans or ras crocomputer. A character      memory is provided separate
terlines. A video game circuit which is capable of dis    from a display memory and character generator mem
playing fixed objects as background, as well as moving 35 ory.
objects, is shown by Rosenthal, U.S. Pat. No. 4,053,740. bytes,Each display memory word is partitioned into two
                                                                 with the first byte being a character memory
   Rosenthal has built a special purpose digital computer
to generate video game information from a plurality of address and the second of which being a sub-address to
selected, on a mutually exclusive basis, software defined locate a character-word within a set of character words
programs. Operator commands are separated into an 40 in memory. Each character memory word is likewise
independent computational section and an independent        partitioned into two bytes with the first byte determin
display section of the circuit for processing. Rosenthal,   ing color and the second byte selecting a particular
U.S. Pat. No. 4,053,740, utilized arithmetic logic units to character from a prestored set.                  :
drive accumulators to control x and y registers and           The use of a second general purpose commercially
associated horizontal and vertical beam direction drive 45 available microcomputer to process video display infor
circuits for cathode ray tube displays.                     mation, while increasing the system speed, also in
   Personal computers, such as the Apple Computer, creases the cost of manufacture for the system, as well
have utilized a main microprocessor to perform compu as the size of the system, i.e., chip "real estate.”
tational operations and to process (retrieve) video dis       A micro control unit is also used and is necessary to
play information to generate displays to a television 50 the circuitry. The micro-control unit decodes instruc
type receiver.                                              tions from a host computer for use by the raster memory
  The Apple Computer has incorporated a general unit and generates (encodes) control information to
purpose microprocessor, the MOS Technology Inc. cause the raster memory to write display information, as
Model 6502, to perform both computational operations well as to control the video control circuit to read infor
and video display information retrieval. Such a single 55 mation from the raster memory and to translate it into
microprocessor driven system has speed limitations, as video signals usable by a CRT drive circuit. Ackley et
most microprocessors, including the Model 6502, have al., U.S. Pat. No. 4,243,984, show a video display pro
significant processing dead time used for refreshing cessor including general circuit components for overlay
registers and resetting and initializing operations. As a control, priority selection, sequence control, and mem
result, information processing in such systems can be 60 ory control of sprite position and color.
slow.                                                          Rahman, U.S. Pat. No. 4,420,770, shows a video
   In order to enhance processing speeds these small background generation system including field correc
microprocessor driven computers have sacrificed dis tion logic, priority encoder circuitry and horizontal and
play quality, i.e., "definition', "character' and "detail.' vertical bit map memory.
   One approach to increasing the speed of such a per 65 Others have developed display circuits which have
sonal computer has been to utilize two processors; a included an address bus, data bus, and control signal
Motorola Inc. 68000 and a 6502. In this system, the first lines for interfacing with a microprocessor based com
processor is dedicated to computational operations and puter system. Some display circuits have included
                            3.
                                                       4,874,164
                                                                                            4.
 DMA control and playfield and sprite-generator con and which can be implemented where inter-chip and
 ponents utilizing a plurality of control registers con backplane wiring is minimized.
 nected to operate with a plurality of memories, includ                 SUMMARY OF THE INVENTION
 ing collision detection and display priority logic.
   Dual commercial microprocessor systems have in            5   The Amiga personal computer is a low-cost high
creased off-chip wire connections as each commercial performance computer with advanced graphics fea
circuit comes as a separate dual-in-line package (DIP). tures. It is an object of the invention to provide a high
 In LSI (large scale integration) circuit design, this in resolution color display, fast graphics for simulation and
creases backplane and circuit card costs and increases 10 COSt.animation, and substantial processing power at low
the likelihood of noise pickup, often necessitating addi
tional filtering and increased signal levels, which usu           High resolution color displays are becoming increas
ally leads to more power consumption. Except in the ingly common because of the continued dramatic de
very expensive dual microprocessor systems-priced creases in the cost of memory. However, the resulting
above the personal computer market-display quality is 15 huge display buffer memory can be painfully slow to
not greatly enhanced with these second microproces draw or move display images around in, especially
sors as noise pickup and filtering costs often dictate a when using only a single conventional microprocessor.
lesser display output quality.                                 This situation is worsened by other large memory trans
   Others have taken a divergent and different ap fer channels, such as multi-channel stereo sound, high
proach, such as using a display generator circuit de 20 speed line buffer objects (such as sprites), and full track
signed as a raster scan line buffer structure. In such an floppy disk buffers, which compete with the display for
approach, a general microprocessor can be used to memory bus time. The conflicting design goals of high
address display object storage random access memory resolution color, fast moving displays, and low produc
(RAM). The circuitry divides the display into moving tion invention.cost have been largely resolved by the features of
objects (sprites) and into stationary objects (playfields). 25 the
                                                               costly by
                                                                               The hardware solutions are made less
                                                                          designing  them on custom silicon chips.
   This approach, while cheaper to implement than the            Extensive use is made of Direct Memory Access
dual microprocessor approaches discussed above, and channels,            to relieve the main microprocessor of most of
using less chip geometry and inter-chip wiring, does the data transfers
provide degraded system performance and display ca to windowed, realand                beam position checking peculiar
                                                                                    time, dynamic displays. The Motor
pabilities compared with the dual microprocessor sys 30 ola 68000 is used as the main          microprocessor. The per
tems.
   One specific display generator enhanced micro that gives it every alternate bus cycle,byallowing
                                                               formance   of the  68000 is enhanced     a system design
                                                                                                                it to run
processor based system is shown by Hogan et al., U.S. at full rated speed most of the time. The special             func
Pat. No. 3,996,585, where a display generator is imple tions described below are produced using two custom
mented with a plurality of buffer registers. He uses this 35 designed VLSI circuits, which work in concert with the
display generator to process bit map information ob 68000 to use the shared memory on a fully interleaved
tained from random access memory (RAM). A pattern basis.             Since the 68000 only needs to access the memory
generator is used to decode data for each raster scan bus during            each alternate clock cycle in order to run
line. Decoded rastor line data is stored in a buffer regis full-speed, the    rest of the time the memory bus is free for
ter for display. The pattern generator also decodes con other activities.          A coprocessor and a data-moving
trol data to determine collisons. The decoded collison        DMA channel called the blitter can each steal time from
control data is stored in a buffer register. Hogan et al.'s   the 68000 for jobs they can do faster than the 68000.
circuit is intended to relieve the system microprocessor      Thus, the system DMA channels are designed with
from simple video display data retrieval and manipula         maximum performance in mind: the task is performed
tion.                                                      45 by the most efficient hardware element available.
   In keeping with the display generator circuit ap             A custom display coprocessor allows for changes to
proach of Hogan et al., others have built a decoder most of the special-purpose registers in synchronization
based video display generators. Such a circuit would with the position of the video beam. This allows such
not utilize a second general purpose microprocessor to special effects as mid-screen changes to the color pal
drive a video generator, but may use display instruction 50 ette, splitting the screen into multiple horizontal slices,
decoder circuits to provide movable object and station each having different video resolutions and color
ary playfield object information to the video display, depths, and beam-synchronized interrupt generation for
thereby reducing the work on the only (general pur the 68000. The coprocessor can trigger many times per
pose) microprocessor present. Any of these circuits, as screen, in the middle of lines as well as during blanking
with Hogan et al., require an increase in memory or 55 intervals. The coprocessor itself can directly affect most
storage space which is satisfied by a large number of of the registers of the special-purpose hardware, freeing
registers. Some video display generators have their the 68000 for general-purpose computing tasks.
circuitry divided into a decoder(s), RAM(S) and regis           Thirty-two system color registers are provided, each
ter(s) for handling playfield fixed-object data; and into a of which contains a 12-bit number as four bits of red,
decoder-selector(s) and register(s) for handling moving four bits of green, and four bits of blue intensity infor
object data.                                                  mation. This allows a system color palette of 4,096
   It is desirable to provide an auxiliary circuit which is different choices of color for each register. A bitmap
intended to be incorporated into a microprocessor display memory organization called bitplane addressing
based personal computer system, which auxiliary cir is used. This method groups bitplanes (instead of pixels)
cuit has true microprocessor capabilities, including bit 65 together in memory, allows variability in the number
map data manipulation capabilities, but does not use the and grouping of biplanes into separate images, and al
space and power of a second microprocessor on the lows increased speed when using reduced numbers of
increase in memory needed by the decoder approach, bitplanes.
                                                    4,874,164
                          5                                                              6
   Eight reusable 16-bit-wide sprites are incorporated       Motorola 68000 16/32 bit microprocessor. These chips
into the hardware with up to 15 color choices per sprite     provide extraordinary color graphics on a standard TV
pixel (when sprites are paired). A sprite is an easily       or on an RGB color monitor, with arcade quality reso
movable graphics object whose display is entirely inde       lution and depth to display video games, cartoons, low
pendent of the background (called a playfield). Sprites resolution photographs, or up to 80 characters of text
can be displayed "over” or "under' this background. on the screen. The sound circuits can duplicate complex
After producing the last line of a sprite on the screen, a waveforms on each of four channels, matching com
sprite DMA (direct memory access) channel may be mercial synthesizers in quality. Chip costs were kept
reused to produce yet another sprite image elsewhere low by using conservative design rules, process specifi
on-screen (with at least one horizontal line between O cations, and logic density. The process selected is a
each reuse of a sprite processor).                           common silicon gate NMOS one that is supported by
   Additional logic allows for dynamically-controllable almost all MOS manufacturers.
inter-object priority, with collision detection. The sys        The Amiga system block diagram in FIG. 8 shows
tem can dynamically control the video priority between the three custom chips, designated Agnus, Denise, and
the sprite objects and the bit-plane backgrounds (play 15 Paula, and how they are connected to the address and
fields), and system hardware can be used to detect colli data bus of the Amiga system. The block diagram
sions between objects so that a program can react to shows the system data bus connecting the RAM 401 to
such collisions.                                             all three custom chips, and to the 68000 microprocessor
   The Blitter is used for high speed data movement, 402 through the bidirectional tristate buffer 403. The
adaptable to bitplane animation. The Blitter efficiently 20 system data bus 404 is 16 bit and is bidirectional. The
retrieves data from up to three sources, combines the register address bus 405, or RGA bus, is bidirectional
data in one of 256 different possible ways, and option only with respect to the Agnus chip. The addresses to
ally stores the combined data in a destination area. The RAM 401 are input from either the Motorola 68000
blitter can draw patterned lines into rectangularly orga processor 402, or from the Agnus chip through the
nized memory regions at a speed of about 1 million dots 25 DRA bus 406, with selection of either source under the
per second; and it can efficiently handle area fill.         control of multiplexer 407. The register address bus 405,
   Additional objects and advantages of the invention or RGA bus, is driven when no DMA is occurring by
will be apparent to those skilled in the art from a read the low address bits on output lines 408 of the 68000
ing of the following description.                            through tristate buffer 409. This allows the micro
                                                          30 processor 402 to read or write the custom chips as if
   BRIEF DESCRIPTION OF THE DRAWINGS                         they were random access memory. When a DMA cycle
   The present invention will be better understood from is needed, the Agnus chip 410 informs the microproces
a reading of the following detailed description of the sor 402 by asserting the data bus request (DBR) line 411.
preferred embodiment in conjunction with the accom The bus control logic 412 then outputs signal DTACK
panying drawings, in which:                         35 on line 413, which suspends operation of the 68000
  FIG. 1 is a block diagram of the address generator microprocessor 402, and switches both tristate buffers
(Agnus) chip;                                          403 and 409 so that processor 402 no longer has access
   FIG. 2 is an operational block diagram of a bitmap to system data bus 404 or RGA bus 405. When in this
image manipulator (blitter) portion of the circuit;          DMA mode, Agnus chip 410 addresses the RAM 401
   FIG. 3 is a block diagram of the light pen registers with its own RAM address bus, the DRA bus 406,
and synch counters portion of the circuit;                   which is selected by the multiplexer 407 for input to
   FIG. 4 is a block diagram of the RAM (random ac RAM 401 under the control of the bus control logic
cess memory) address generator portion of the cir 412, while simultaneously placing a destination address
cuitry;                                                      for the data on the register address (RGA) bus 405. The
   FIG. 5 is a block diagram of the bitplane DMA con 45 register address on the RGA bus 405 selects one of a
trol logic;                                                  plurality of registers on any of the three custom chips,
   FIG. 6 is a block diagram of the sprite vertical com including Agnus chip 410, as the destination of the data
parator and position registers portion of the circuitry;     from the RAM 401.
   FIG. 7 is a block diagram of the coprocessor (cop           Operation of the Amiga computer system as a whole
per);                                                     50 with a more detailed description of the interaction be
   FIG. 8 is a block diagram of the Amiga system;            tween the microprocessor 402 and the custom chips,
   FIG. 9 is a block diagram of the display encoder Agnus chip 410, Denise chip 420, and Paula chip 430, is
(Denise) chip;                                               described in the copending application filed July 19,
   FIG. 10 is a block diagram of the bitplane data regis 1985, entitled “Video Game and Personal Computer',
ters and serializers;                                     55 Ser. No. 756,910, which is hereby incorporated by ref.
   FIG. 11 is a block diagram of the sprite data registers erence. The present application is principally concerned
and serializers;                                             with the hardware and features associated with the
   FIG. 12 is a diagram of the collision detection logic; Agnus chip 410 and the Denise chip 420. Block dia
and                                                          grams of the Agnus chip and the Denise chip are shown
   FIG. 13 is a diagram of the display priority control 60 in FIGS. 1 and 9, respectively. A description of the
logic.                                                       hardware and features associated with the Paula chip
        DETAILED DESCRIPTION OF THE                          430 is described in the copending application filed July
            PREFERRED EMBODIMENT                             18, 1986, entitled “Peripheral Control Circuitry for
                                                             Personal Computer', Ser. No. 886,614. which is hereby
   The Amiga personal computer is a low cost, high 65 incorporated by reference.
performance graphics and sound system for state of the         The Agnus chip 410 is the address generator chip
art video game and personal computer applications. (FIG. 1). It is 238X281 mils, and contains about 21,000
The system includes three custom IC's controlled by a transistors. Its main function (in chip area) is the RAM
                             7
                                                    4,874,164
                                                                                         8
 address generator 45 and register address encoder 43 DMA channel. The 8 bits of the RGA bus 405 provide
 that produce all register and RAM addresses during enough address information so that each register on the
 DMA cycles. DMA (direct memory access) is a method three chips can have its own unique address, and some
 for transferring data between memory and one of the times separate ones for read/write, without separate
 custom chips without requiring execution of an "inter chip select lines or register read/write lines. Whenever
 rupt' routine by the microprocessor 402. The Agnus the Agnus chip 410 is not performing a DMA operation,
 chip contains all of the DMA channel controllers for the encoder 43 will put eight 1's on the RGA bus 405,
 the Amiga system. It also contains a hardware bit map which signifies the default or "no address' address.
 image manipulator 67, called the Blitter, and a display        While a destination for data from RAM 401 is placed
 synchronized coprocessor 47, referred to as the Copper. 10 on the register address bus 405 by the register address
 The Agnus block diagram shows the DMA control encoder 43, the RAM address generator 45 generates an
 logic and the drivers for the register address bus 405 and address for accessing a memory word in the RAM 401
 RAM address bus 406. The output of each one of the and places it on the DRA bus 406. Thus, when a DMA
 DMA controller circuits is labeled with two numbered         operation occurs, the Agnus chip 410 asserts the data
arrows. These arrows indicate the number of DMA 15 bus demand line 411 and addresses a word in the RAM
 channels from each of these controllers that are driving with RAM address bus 406. The RAM address genera
the register address encoder 43 and the RAM address tor 45 is shown in greater detail in FIG. 4.
 generator 45.                                                  The Amiga personal computer system provides a
   The Agnus chip 410 generates two addresses, for the total of 25 DMA channels. As shown in FIG. 1, control
source and destination, for all DMA data transfers in 20 signals for all 25 DMA channels are input into the RAM
volving any of the three chips, including data transfers address generator 45. The RAM address generator 45
utilizing registers on the Agnus chip 410 itself. The contains a set of 25 pointer registers 138 (FIG. 4). Each
source of DMA data transfers is almost always the of the pointer registers contains an 18-bit address, which
dynamic RAM, which is addressed by the RAM ad points to the location in memory of data to be fetched
dress generator 45. The chip registers are almost always 25 next for the particular DMA channel. The pointer regis
the destination of the DMA data transfers, and are ad ters 138 are loaded with data (an address) from data bus
dressed by the register address encoder 43.                   404 by the processor 402 or coprocessor 47 under pro
   The priority control logic 73 outputs a bus demand gram control. The DMA channels are associated with
signal DBR on line 411 to the bus control logic 412 the sprite DMA control logic 41 (eight channels), the
shown on FIG.8 whenever a DMA operation is needed 30 Copper 47 (one channel), the audio DMA control logic
in order to prevent the 68000 microprocessor 402 from 53 (four channels), the bitplane DMA control logic 57
accessing the RAM 401 during a DMA operation. Each (six channels), the disk and refresh DMA control logic
of the DMA controllers 41, 47, 53, 57, 61, and 65 sends 61 (2 channels), and the Blitter DMA control logic 67
out a priority request signal and receives a priority (four channels). For each of the 25 DMA channels, an
enable signal from the priority control logic 73. The 35 18 bit RAM address pointer is stored in a designated
actual logic is similar to a daisy chain connecting the pointer register 138 and is subsequently output on the
DMA controllers and giving different priority to differ DRA bus 406 when that channel is active in order to
ent types of DMA requests. The logic 73 receives the select the memory address of the data in RAM 401 to be
video beam count from video beam counter 117, which accessed by DMA. The DRA address lines from the
is contained within synch counter circuits 31, and Agnus chip 410 are already pre-multiplexed within the
which can affect the priority given certain DMA chan chip into high and low order bytes by multiplexer 69, so
nels. Memory access cycles are allocated among the that 9 rather than 18 lines are output from the Agnus
DMA controllers and the processor 402, as will be chip 410 onto the RAM address bus 406 at one time,
described subsequently. Thus, for example, if the video thereby saving nine pins for other purposes. The multi
beam count indicates that the beam is scanning the dis 45 plexer 69 in FIGS. 1 and 4 includes an output buffer
play and is not being blanked, the DMA controller for register 141 that is directly connected to the DRA bus
the bitplane display will be given priority and a bus 406.
demand signal will be output by logic 73 whenever the           The RAM address bus 406 is a nine pin bus that
bitplane DMA controller requests access to the data bus carries 18 bits of multiplexed address data to address
404.                                                       50 one of 256K words (512K bytes) stored in the RAM
   In order to select a register on any of the three cus 401. The bus 406 is always driven by chip 410, and will
tom chips as the destination or source for data to/from drive the address pins on the RAM401 when externally
the RAM 401 on the data bus 404, the register address selected and demultiplexed. Addresses on the bus are
encoder 43 places a prewired address on the RGA bus generated one-half memory cycle early in order to be
405 whenever one of the 25 DMA channels on the 55 latched into the RAM 401 before data is actually trans
Amiga computer is activated. All addresses on the reg ferred. The least significant nine bits of the RAM ad
ister address bus 405 are input to the register address dress are output on bus 406 during the last half of the
decoder 27 on the Agnus chip 410, which has a plurality preceding memory cycle. The most significant nine bits
of output lines 29 to the Blitter, the Copper, and all the of the RAM address are output on bus 406 during the
other registers contained on the Agnus chip. If one of 60 first half of the present DMA cycle. During the second
the registers on the Agnus chip 410 is being addressed, half of the present DMA cycle, data contained in the
the decoder 27 places an output on a single one of its RAM is transferred to the selected register in one of the
output lines 29, which will enable the data bus 404 to be three custom chips, and simultaneously the least signifi
accessed only by the specific register selected by the cant nine bits of the RAM address for the next (if re
address on register address bus 405. The register ad 65 quired) DMA cycle are placed on the RAM address
dress encoder 43 is driven by the DMA channel con bus.
trollers and drives the register address bus 405 with a         If the RAM is the destination during a data transfer,
unique code selected by the control logic for each data will be transferred to the RAM from a register
                                                    4,874,164
                           9                                                              10
during the first half of the present DMA cycle as well,        ning of the data to be used in displaying the next video
which is called an early read. Although many registers scan line. The six bitplanes have only two modulo regis
act as sources of data when read by the microprocessor ters, so that one register is reserved for even and one for
402, only two chip registers are sources of data for odd numbered bitplanes. Thus, for each of two play
DMA data transfers into RAM 401. These are the Blit            fields, a larger image can be stored in memory than is
ter destination register 113 and a disk data read register displayed on the screen. Each Blitter channel has its
(not shown). These types of DMA operations use early own modulo register. Therefore, each of three "source'
read cycles because data must be read very early from images and one "destination' image handled by the
the chip register in order to have the data available at Blitter can have images of different sizes stored in mem
the RAM 401 before the end of the first half of the O ory, although the screen, of course, can only display a
DMA cycle. As a result, there is no time for a register window of a single size.
address to be placed by the Agnus chip 410 on the                 There is an 18 bit adder 137 in the RAM address
register address bus 405. Therefore, the early read ad generator 45 that performs any incrementing and decre
dresses put on the RGA bus 405 are only dummy ad menting of the pointers in the pointer registers, and
dresses for cycle identification. The chip register data is 15 which also adds or subtracts the modulos stored in the
automatically output by the Agnus chip 410 at the be modulo registers 131 for the bitplane and Blitter DMA
ginning of the present DMA cycle because the chip can channels when the beam scanning the screen has
determine in advance when either of the these two              reached the end of a horizontal scan line (as defined by
DMA cycles is about to occur.                                  comparing the video beam count with the value in a
   The RAM address generator 45 of FIG. 4 is com 20 data fetch stop register). The adder 137 also can be
posed of a RAM address bus 406, a group of 25 pointer switched to "add' (substitute) the values in the six
registers 138, a group of six modulo registers 131, and a backup registers 129 in place of the values in the corre
group of six backup (or location) registers 129. The 25 sponding pointer registers 138 upon occurence of the
DMA channels described above each use an address               audio DMA or Copper DMA events described above.
pointer to address dynamic RAM 401 when access to 25 The backup registers 129 and modulo registers 131 have
the data bus is obtained. The registers 138 are 18 bit their outputs to the adder 137 under the control of en
registers that are loaded with a starting value by the able lines 29 from the register address decoder 27 of
microprocessor 402 or the Copper 47. Each pointer is FIGS. 1 and 4, so that only one modulo or backup value
used as an address on the DRA bus 406 and is typically is input to adder 137 at a time. As shown in FIG. 4, a
incremented by one to point to the next address in mem 30 gate inhibit signal on line 133, responsive to the Copper
ory the next time it is utilized. When a DMA channel 47 and audio DMA controller 53, controls a gate 135.
must be quickly restarted over and over again at the This gate 135 controls the backup reloading operation,
same address, the address pointer is reloaded from a during which the gate 135 drives all inputs to adder 137
hardware register automatically. This is done using the from the registers 138 to zero, and the adder 137 is
backup, or location, registers 129. There are six backup 35 operating in the add mode, so that the value in the
registers 129, four for the four audio channels, and two backup registers 129 is substituted for the previous
location registers for the two copper indirect jump value in the register 138. An invert instruction and a
registers. In the case of audio DMA, the backup value is carry instruction is also provided to the adder 137 from
reloaded into the pointer register whenever the audio the DMA controllers. Four operations are performed
waveform being output is finished. In the case of the by the adder 137 in response to the two bit input pro
coprocessor or Copper 47, the backup value is reloaded vided by the carry and invert instructions. The invert
(strobed) into the pointer register 138 (program instruction causes the adder to operate in descending
counter) whenever the (strobe) address which corre mode, as required, for example, during certain blitter
sponds to either of the two copper location registers 129 operations involving overlapping memory. Thus, sub
is written.                                                 45 tract or decrement by one operations are chosen instead
   The bitplane DMA control logic 57 and Blitter 67 are of add or increment operations. The carry instruction
utilized in the display of bit-mapped video images. causes the adder to add or subtract two inputs, instead
When the window, i.e., the video image to be displayed of merely incrementing/decrementing the pointer, as is
on the screen, is a portion of a larger image stored in required in order to use the modulo and backup values.
RAM 401, it is necessary to increase the value of the 50 The adder 137 provides the pointer return value, which
data address stored in the bitplane pointer registers 138 is output into multiplexer 139, in order to place the
from an address corresponding to the end of one hori address to be used during the next memory cycle into
Zontal line of pixels to the address corresponding to the the pointer register 138. The multiplexer 139 also re
beginning of the next line of pixels to be scanned for that ceives an input from the data bus 404. More than 16 bits
image. In order to accomplish this, modulo registers 131 55 are provided from the 16 bit system data bus by repeat
are utilized. There are six modulo registers 131, four for ing several of the bits on the bus as inputs to the multi
the four Blitter channels, and two that are used sepa plexer 139. Either the data on the data bus 404 or the
rately by the three even and three odd bitplane chan pointer return value from the adder 137 will be selected
nels. The modulo registers are preloaded with an ad by multiplexer 139 and be loaded into the particular
dress jump value that equals the number of words in pointer register 138 selected by the register address
memory between the last word being displayed on the decoder 27.
screen on one horizontal line and the beginning of the            The bitplane control registers 55 and bitplane DMA
first word on the next line. Whenever the end of a video       controller 57 are shown in FIG. 5. There are several
scan line is reached, instead of merely incrementing the bitplane control registers, shown as registers 143, which
address contained in the corresponding pointer registers 65 receive data from the data bus 404. The control regis
138 by one, the address jump value stored in the modulo ters 143 include bits for enabling each bitplane and are
register 131 is added to the address pointer in order to loaded under the control of an enable signal from the
access the data in RAM 401 corresponding to the begin register address decoder 27. The outputs from the regis
                             11
                                                       4,874,164
                                                                                            12
 ters 143 are input in parallel to a state sequencer 145           The Copper 47 is a coprocessor that utilizes one
 along with timing inputs and a bitplane run signal. The DMA channel to fetch its instructions. The pointer
 sequencer 145 pulses one of six output lines for each of stored in the pointer register 138 corresponding to the
 the six bitplane DMA channels. Each output line is sent Copper 47 is the instruction or program counter, and
 to both the RAM address generator 45 and the register must be preloaded with the starting address in memory
 address encoder 43. The outputs to the RAM address of the program instructions for the Copper. The Copper
 generator 45 of FIG. 4 are used to select a particular can control nearly the entire graphics system, freeing
 pointer for output on the RAM address bus 406 in order the processor 402 to execute program logic. The Cop
 to access bitplane data stored at that address in RAM. 10 per can also directly affect the contents of most of the
 Identical outputs to the register address encoder 43 registers on the chips. The Copper serves as a powerful
 cause the encoder to select the 8 bit code that must be        tool for directing midscreen modifications in graphics
 output on the register address bus 405 in order to select displays and for directing changes in register values that
 a destination for the bitplane data from memory. The must occur during the vertical blanking period between
 bitplane run signal online 149 is from bitplane start/stop 15 displays. Among other things, the Copper can control
 control logic in the priority control logic 73 and gives register updates, reposition sprites, change the color
 priority to the bitplane DMA controller when it re palette, update the audio channels, and control the Blit
 quests memory access. The run signal is output only ter. The Copper 47 is a coprocessor and has its own
 when the video beam count indicates the display is on instruction set consisting of only three instructions. The
 and must therefore be given priority. This occurs when 20 Copper can: WAIT for the beam scanning the screen to
bitplane start/stop control logic indicates the video reach a specific screen position specified as X and Y
beam count is between the limits set in display window coordinates;
                                                                RAM     into
                                                                                 MOVE an immediate data value from
                                                                               one   of the special purpose registers; and
start and stop and data fetch start and stop registers
included among the bitplane control registers. The cir SKIP the next instruction if the video beam has already
cuitry shown in FIG. 5 for generating outputs on lines reached a specified screen position. All of these instruc
to the encoder 43 and pointer registers 138 is similar to 25 tions    consist of two 16 bit words in sequential memory
                                                                locations. The Copper fetches both words each time it
that used for all the DMA controllers.
   The synch counters and light pen registers 31 are tions     fetches an instruction. The MOVE and SKIP instruc
shown in FIG. 3. The circuitry has access to the data words,require              two memory cycles and two instruction
                                                                         and the WAIT instruction requires three mem
bus 404 when enabled by one of the lines 29 from the 30 ory          cycles. In accordance with the DMA time slot
register address decoder 27. A light pen input signal 33
is fed into the light pen register circuitry 119, and a allocation           set up for the Amiga system, only the odd
television synch signal 35 is output by the synch video memory cycles are
                                                               memory      cycles
                                                                                    are
                                                                                       requested by the Copper 47, so four
                                                                                         required for execution of MOVE
beam counter 117 to the display to synchronize its oper and SKIP instructions               and six memory cycles are re
ation with that of the processor. The light pen signal 33 35 quired for the WAIT instruction.
is received from a light pen port connected to the cir            The MOVE instruction transfers data from the RAM
cuit and can cause the beam count when the beam
passed the light pen to be loaded onto the data bus 404 MOVE   401   to a register destination. The first word in the
                                                                          instruction contains the address of the destina
under the control of the register address decoder 27. tion register, while the second word of the MOVE
The output of the synch video beam counter 117 is input instruction is irrelevant (it contains the data to be trans
into the copper 47, the sprite vertical position compara ferred). The WAIT instruction causes the Copper 47 to
tor 39, and into the priority control logic 73. The beam wait        until the beam position count equals or is greater
count is important in determining what DMA control than the                coordinates specified in the instruction. While
lers can demand the next memory cycle, in displaying waiting, the              Copper is off the system data bus 404 and is
sprites, and in changing the contents of registers by the 45 not using any         memory cycles. The first instruction
Copper 47 during a blanking interval or in the middle of word contains the             vertical and horizontal coordinates
a display.                                                     of the  beam    position.  The second word contains enable
   The vertical position and comparison logic for the bits that are used to form               a mask that indicates which
sprites is shown in greater detail in FIG. 6. Vertical start bits of the beam position count to use in making the
location registers 153 and vertical stop location regis 50 comparison. The SKIP instruction causes the Copper to
ters 155 are loaded with data from the data bus 404 for        skip the next instruction if the video beam position
up to eight possible sprites under the control of the count            is equal to or greater than the value given in the
register address decoder 27. Each sprite channel sends instruction.
two output lines 120 to a state sequencer in the sprite           The Copper 47 is shown in greater detail in FIG. 7. A
DMA controller 41 in order to start and stop display of 55 first instruction register 173 stores the contents of a first
the sprite. The synch video beam counter 117 outputs instruction word received from the data bus 404, while
the vertical portion of the count to a sprite vertical a second instruction register receives the contents of a
position comparator 39. The other inputs to comparator second instruction word received from the data bus 404.
39 are provided by both the vertical start and stop loca The loading of data from the bus 404 to registers 173
tion registers for each sprite. When the vertical count and 175 is controlled by enable signals sent on lines 29
exceeds or equals the value in either of the registers 153 from the register address decoder 27. The least signifi
and 155, output is sent on the corresponding line 120 to cant bit in the first instruction word and in the second
the sprite DMA controller 41. The sprite DMA con instruction word are used to determine which of the
troller has a state sequencer that receives the vertical three possible instructions is to be executed. Thus, sin
position comparator outputs for each of the eight sprites 65 gle bit control lines 177 and 181 input the least signifi
and, in turn, drives the register address encoder 43 and cant bit of the first and second instruction words, re
pointer registers 138 in RAM address generator 45 with spectively, into an instruction operational code decoder
output lines for each of the eight sprites.                    179. The operational code decoder 179 uses the two bits
                                                    4,874,164
                            13                                                         14
of input to determine the instruction to be executed, and   ing location register is loaded into the Copper 47 pro
will enable either the MOVE instruction line 183, the        gram counter. This causes the Copper 47 to "jump' to
SKIP instruction line 185, or the WAIT instruction line      a new location in memory, from which its next program
187. These three output lines identifying the requested instruction will be fetched. The program instruction
instruction are input into a state sequencer 199.          5 fetch then continues sequentially until another jump
   The least significant eight bits (not including bit 0) address strobe from register address decoder 27 occurs.
loaded into the first instruction register are output to At the start of each vertical blanking interval, the ad
delay latches 191. If and only if a MOVE instruction is dress in first location register 129 is automatically used
being executed by the Copper 47, these eight bits spec to start the program counter and the Jump 1 output is
ify the address of the register that is the destination of O activated. Thus, when the end of a vertical blanking
the data that is on the data bus during fetch of the sec interval occurs, the Copper 47 will automatically restart
ond word instruction. If a MOVE instruction is being its operations with the instruction in RAM 401 at the
executed by the Copper, the eight bits from the delay address specified in the first location register 129.
latches 191 will be output at a later time from the regis      The Blitter DMA controller 65 operation is suffi
ter address encoder 43 to the register address bus 405 15 ciently described by reference to FIGS. 4 and 5. The
and the buffer circuitry 21. The placement of the eight Blitter control registers are each enabled by a line 29
bits on the RGA bus 405 enables the particular register from the register address decoder 27 in order to transfer
being addressed to receive data that is output to the data data from the bus 404 into one of the registers 63. The
bus 404 from the RAM 401 address specified in the Blitter control registers 63 have outputs sent to a state
pointer register 138 corresponding to the copper.         20 sequencer, which is similar in structure to the state
   The video beam position counter 117 contained sequencer 145 described with respect to the bitplane
within the synch counter circuitry 31 outputs 15 bits of controller 57. The state sequencer outputs, four in all
data to a comparator 193 within the Copper 47. The for the four Blitter DMA channels, are input to the
contents of the video beam position counter 117 indi register address encoder 43, which provides the priority
cate the specific position that the electron beam scan 25 control logic 73 with a priority request signal in order to
ning the display has reached on the screen. Bits 1-15 in generate a data bus demand on line 411 to the bus con
the first instruction word register during a WAIT or a trol logic 412, and which also outputs the code selecting
SKIP instruction specify the horizontal (bits 1-7) and a particular register on the register address bus 405. The
vertical (bits 8-15) beam position, and form one set of four outputs are also sent to the RAM address generator
inputs to an AND gate 195. The value input from the 30 45, where one of the pointer registers is selected and
beam counter is compared within the comparator 193 where additional adder control circuitry exists to gener
with a value input from the AND gate 195. The other ate an invert instruction and a carry instruction as inputs
set of inputs to the AND gate 195 is provided by the to the adder 137.
least significant bits (not including bit 0) contained in      The implementation of the audio DMA controller 53
the second instruction word register 175. These bits are 35 shown on FIG. 1 is very similar to the circuitry shown
enable bits that are used to form a mask, so that the for FIGS. 4 and 5 for bitplane DMA control. There is a
comparator 193 will ignore certain bits in making the single set of registers 51 for holding left and right audio
comparison during a WAIT or a SKIP instruction. In control information, and these registers have outputs
the comparator 193, the beam position bits specified by connected to a state sequencer with four outputs similar
the first instruction word that are not masked by the to the state sequencer 145 shown for the bitplane DMA
enable bits in the second instruction word are tested        channels in FIG. 5. Additional outputs are provided,
against the count of the video beam position counter however, to the backup registers by the audio DMA
117 before any further action is taken. The comparator controller rather than to the modulo registers as in the
193 output is sent to the state sequencer 199.               case of the bitplane and Blitter DMA controllers. These
   The state sequencer 199 provides three outputs in 45 outputs, like the Copper 47 jump outputs, are wired-OR
response to jump address strobes and to input of the together and feed the line 133 providing the gate inhibit
result of the beam count comparison and the inputs signal to gate 135 in order to cause substitution rather
identifying the instruction being executed. The fetch than addition by adder 137. In contrast, for the bitplane
output on line 219 is sent to both the register address and Blitter control registers 55 and 63, certain registers
encoder 43 and the pointer register (program counter) 50 (such as the display window start and stop registers or
in the RAM address generator 45, so that the Copper 47 the Blitter size register) are loaded with display position
can access memory if the priority control logic 73 so count data in order to enable the sending of outputs to
allows. Output lines 221 and 223 are sent to the RAM the modulo registers 131 at the proper time.
address generator 45 shown in FIG. 4. The gate inhibit         The hardware for the Blitter 67 is shown in an opera
signal on line 133 in FIG. 4 results from output lines 21 55 tional block diagram in FIG. 2. Data on the data bus 404
and 223 being wired-or together, so that either output is input into the A and B source data registers 77 and 79
causes the adder 137 to substitute a value in the backup under the control of the register address decoder 27.
(location) registers 129 into the program counter 138. The A and B source data registers 77 and 79 each com
The two outputs, Jump 1 and Jump 2, are also sent to prise two 16 bit registers, with A and Bold source data
two respective location registers 129 containing the 60 registers 77a and 79a storing the data word that was
address in RAM 401 of the next instruction to be exe         previously input to registers 77 and 79. The A and B
cuted by the Copper 47. A first location register 129 and source data registers each output two 16 bit words into
a second location register 129 contain the two indirect the 16 bit barrel shifter 81. Data on the data bus 404 is
jump addresses used by the Copper 47. The Copper 47 also input to first word and second word A mask regis
fetches its instructions from RAM 401 using its program 65 ters 83 and 85. The output from these mask registers is
counter (pointer register 138), incrementing the pro input for loading into the A source mask logic 90. The
gram counter after each data fetch. When a jump strobe A mask logic 90 receives control signals (which also
address is written, the address stored in the correspond    may enable the modulo registers 131) from the Blitter
                        15
                                                      4,874,164
                                                                                          16
DMA controller 5 of FIG. 1 when the word in register           corresponding to each of the six bitplanes and constitut
77 is the first and/or last in the Blitter window for a        ing the bitplane bus 333. Bitplane bus 333 is connected
horizontal line.                                               to output color register selection data to both collision
    Data bus 404 also provides an input into the C source detection logic 335 and display priority control logic
 data register 89, which is also loaded under control of 5 337.
 the register address decoder 27. The C source data                A horizontal synch beam counter 339 exists on the
 register 89 sends data to a logic unit 91, which is a logic Denise chip, and is synchronized with the beam counter
 unit that can be controlled to perform any one of 256 117 on the Agnus chip 410. The output is connected to
 possible logic operations on the three inputs it receives the bitplane control registers 327 and to sprite horizon
 from the A, B, and C registers. An Ashift count register O tal position comparator logic 341.
 93 and a B shift count register 95 among the Blitter              Sprite horizontal position registers 343 receive data
 control registers 63 are each loaded with four bits of from the data bus 315. The output from each of eight
 data from the data bus 404. The 4 bit outputs are pro sprite horizontal position registers 343 is input as a sec
 vided by shift count registers 93 and 95 to the barrel ond input to the sprite horizontal position comparator
 shifter 81. The barrel shifter 81 can perform up to 15 bits 15 logic 341. This sprite position comparator logic 341
 of shifting separately for the A and B source data regis compares an 8-bit word from the horizontal synchbeam
 ters 77 and 79, with the shifter containing 32 bits from counter 339 with a word from each of the sprite hori
 each source. A 16 bit output from the barrel shifter 81 zontal position registers 343.
 for each source is provided to the A and B holding                There are two 8-bit sprite data registers 345 receiving
 registers 101 and 102. The holding registers 101 and 102 20 data from data bus 315 for each of eight sprites receiv
have 16 bit outputs. One of the Blitter control register ing data from data bus 315. These sprite data registers
 63 receives a data word from the data bus 404. Eight 345 output color register selection data to sprite select
bits in this Blitter control word contain multi-minterm         serializer circuitry 347, which acts as a serializer and
select bits that are input to the logic unit 91 and select outputs eight pairs of signal lines corresponding to each
which of the eight available minterms to combine to 25 of eight sprites to form a sprite bus 349. The sprite bus
select one of 256 possible logic operations that can be 349 is therefore 16 bits wide. The output from the sprite
performed on the A, B, and C source inputs.                     horizontal position comparator logic 341 is input to the
   The logic unit 91 also includes fill logic circuitry. The sprite select serializer 347. Sprite bus 349 is connected
fill logic circuitry operates to "fill in' bits between the to output color register selection data to both the colli
horizontal outlines of an object that is being displayed 30 sion detection logic 335 and the display priority control
on the screen. It generates the data if one of the Blitter logic 337.
control registers 63 has been loaded with bits enabling            A collision control register 351 receives data from
the fill operation. The fill logic for each bit and each data bus 315. The output from the collision control
word has a fill carry out signal on line 107 which is register 351 is input to the collision detection logic 335.
input to the logic for the next bit, or for the first bit of 35 A 16-bit output from the collision detection logic 335 is
the next word if the Blitter operations on the present input to a collision storage register 353, which is con
word are complete. The exclusive OR circuitry 108, nected to send the data out on data bus 315.
once a '1' is found for the first time on a horizontal line,      Bitplane priority and control registers 355 receive
will change all subsequent zeroes on the line to "l's, data from the data bus 315. The output is connected to
until another "1" is found on the line. The logic unit 91 the display priority control logic 337. Display priority
output is input to a D holding register 113. The output control logic 337 sends 5-bit color register selection
from the D holding register can be sent out on the data data to a color select decoder 357.
bus 404 and stored in the RAM 401.                                The color select decoder 357 has 32 lines of output
   Data is conveyed with the display encoder (Denise) which are exclusively selected to enable one of 32 color
chip 420 via the data bus 404 (FIG. 9). A bidirectional 45 registers 359, which operate to provide the video to the
buffer 313 is connected to the data bus, and a continua display using 12-bit codes that control the red, green
tion 315 of this data bus continues throughout the cir and blue guns used to generate the image on a display.
cuits on the Denise chip 420. This data bus 315 is 16 bits The 32 color registers 359 are loaded with data from the
wide. Various registers receive or send data onto the data bus 315.
data bus 315. These registers are controlled by load 50 The video output is sent to hold and modify logic 360,
enable signals 317 from a register address decoder 319, which also receives inputs from the bitplane bus. The
which utilizes destination "instructions' placed into the logic 360 is enabled by an output from one of the bit
address decoder 319 via the register address bus 405 and plane control registers 355.
through a buffer circuit 323 connected to a register              Auxiliary peripheral controllers such as mouse count
address bus continuation portion 325, which is 8 bits 55 ers 361 can also be connected to data bus 315. Such
wide. The register address decoder 319 decodes a desti mouse counters 361 are used with commercial cursor
nation "instruction' and provides an output on one of positioning devices. Such mouse counter circuits 361
the lines 317 to enable a data transfer into or out of a        receive and dump data onto the data bus 315.
particular destination register.                                  The bitplane data registers 331, of which there are six,
   Among the registers connected to the data bus 315 are each 16 bits wide (FIG. 10). Each of the six bitplane
are bitplane control register 327. These registers 327 data registers 331 passes 16-bit information into a corre
send control signals to the bitplane select serializer cir sponding one of six bitplane parallel-to-serial registers
cuitry 329. Bitplane select serializer 329 acts as a serial 363 in bitplane serializer 329. The transfer of the data in
izer for bitplane data received from the bitplane data each bitplane data register 331 to a corresponding paral
registers 331, of which there are six. Each register 331 is 65 lel-to-serial register 363 occurs after data for all active
connected to send data to the serializer circuitry 329 bitplanes has been transferred to the bitplane data regis
when selected by the register address decoder 319. The ters 331 under DMA control. Each bitplane parallel-to
outputs of the bitplane select serializer 329 are six bits serial register 363 passes bitplane information in serial
                                                       4,874,164
                             17                                                             18
form on a corresponding one of six output lines con              ter is loaded with the bits defining its color from the
prising the bitplane bus333. This occurs after line 317 to       data bus 315.
bitplane data register 1 has caused this register to be                       THEORY OF OPERATION
loaded, triggering the simultaneous dump of data by
each of the bitplane registers into the corresponding               There are two basic parts to any display which can be
serializers in response to bitplane control register enable      seen on the display screen when using the Amiga per
signal on lines 365 from the bitplane control registers          sonal computer. First, are objects which are easily mov
327.                                                             able, called sprites. Second, are things which do not
   The sprite select serializer portion 147 of the Denise move or can only move slowly, called playfields or
chip, FIG. 11, uses parallel-to-serial conversion and O playfield objects. The playfield is the background
serialization, as does the bitplane select serializer 329 against which the sprites and objects may be displayed
described above. The sprite data registers 345 are com or with which the sprites and objects can interact. A
prised of two 16-bit sprite data registers 367 for each of playfield object is simply a smaller subsection of the
the eight sprites. A total of eight pairs of 16-bit registers 15 playfield, but it is considered by the software in the
367 receive data from the data bus 315. Each individual          Amiga system to be an object of some kind. Even
sprite data register 367 is connected to a corresponding though playfield objects are classified as non-moving
sprite parallel-to-serial register 369, of which there also objects, these objects can appear to move by using a
are a total of eight pairs. Each of the 16 sprite parallel technique called playfield animation. Thus, the Blitter
to-serial registers 369 feeds sprite data serially onto a allows playfield objects to be rapidly redrawn on the
corresponding one of the 16 output lines comprising the screen, while saving and restoring the background or
sprite bus333. Output from each pair of registers 369 for playfield         onto which they are drawn, to give the illusion
each sprite is under the control of signals on 8 pairs of ofThere    motion.
                                                                            are two different operating modes for the play
outputlines 371 from the sprite horizontal position com field display:           normal resolution and high resolution. In
parator logic 341 to each of the registers 369.               25 normal resolution mode, there are 320 picture elements
   The collision detection logic 335 is shown in greater or pixels which form each horizontal line of the screen.
detail in FIG. 12. Collisions can be detected when two
or more objects, as defined by any non-zero bits used to This          is the resolution generally used for standard home
display any of eight sprites or two playfields, overlap in available onHigh
                                                                 television.
                                                                                 a
                                                                                     resolution pictures are normally only
                                                                                   high  resolution monochrome or RGB
the same pixel position. A logic array network consist 30 monitor. In high resolution
ing of two stages of NAND gates 373 and 375 (gates 373 which form each horizontal mode,          line of
                                                                                                        there are 640 pixels
                                                                                                         the screen display.
being the first stage and gates 375 being the second There are normally approximately 200                   lines per display
stage) forms the collision detection logic. The first stage screen in a vertical direction. In interlace
of NAND gates 373 receive inverted data (using invert ever, there are approximately 400 lines mode,                     how
                                                                                                                 per display
ers 372) or non-inverted data from each line of the bit 35
plane bus 333 and the sprite bus 349, and from each line screen  video
                                                                          in the vertical direction. In interlace mode, the
                                                                        scanning   circuitry displays a set of 200 lines dur
output from the collision control register 351. Each of ing one frame (which occurs 60 times per second), but
the second stage NAND gates 375 has connected as on the very next display frame, the video scanning cir
inputs thereto a selected number of the outputs from the cuitry interlaces a different 200 lines on the screen by
first stage NAND gates 373 for certain sprites or play placing the 200 lines of each frame in between each
fields to form a MINTERM. The bits loaded in the                 other. This provides double the vertical resolution. The
collision control register 351 determine whether odd count from video beam counter 117 includes a long
numbered sprites and specific bitplanes will be utilized frame bit used for interlace mode to distinguish the two
by the detection logic 335 in setting the bits in collision frames. Bitplane control registers 55 and 327 contain the
storage register 353. Depending on the implementation 45 bits which define both the horizontal bit resolution and
selected by the bits in control register 351, the polarity the interlace mode for vertical resolution. One bit se
of the bits used to detect a collision can also be speci lects the high resolution mode, and another bit enables
fied.                                                            the interlace mode.
   The bitplane and display priority portion of the cir             In the Amiga system, the user can define a color
cuit is shown in FIG. 13. The display priority control 50 "palette' containing 32 out of a possible 4096 available
logic 337 is implemented by a logic array network con colors. In normal resolution mode, any one of the 32
sisting of two stages of NAND gates 377 and 378. The colors in the palette can be selected and matched with
first stage of NAND gates 377 receives inverted data any one of the pixel elements that make up the overall
(through inverters 376) or non-inverted data from each picture being displayed. A pixel is the smallest picture
of six lines of the bitplane bus 333 and 16 lines from the 55 element in the video display. In high resolution mode,
sprite bus 349, and also receive inputs from the bitplane each pixel can be any one of 16 colors contained in the
priority register 355, to generate an array of MIN color palette. In the special hold and modify operating
TERMS. A selected combination of the first stage mode, up to 3616 colors can be written on the screen at
NAND gate 377 outputs are used to generate the 5 bit the same time for a standard television, or up to 4096
output sent to the color select decoder 357. The sprites 60 colors can be drawn on the screen of an RGB monitor.
have fixed priorities with respect to each other, but the           Each pixel displayed on the screen is represented by
priority of the even and odd bitplanes with respect to one or more bits in the Amiga random access memory
sprites and each other can be controlled with the bit 401. Thus, for each individual pixel, there is a corre
plane priority register 355.                                     sponding set of bits in the computer memory which
   The color select decoder 357 provides 32 control 65 determines which of the 32 color registers 359 contains
lines corresponding to the 32 color registers 359 for the color information for that pixel. Because the pixels
selecting the three 4-bit color code words for red, are organized in a two-dimensional (horizontal and
green, and blue video color intensity. Each color regis         vertical) array, the playfield is referred to as a color
                                                     4,874,164
                               19                                                          20
 plane. The corresponding sections in RAM 401 that by controlling the relative visual priority of the play
 contain bits that determine the color of each of the           fields and sprites, using the bitplane priority register
 playfield pixels are called bitplanes. The value of the 355. In dual playfield mode, the two playfields are com
 color to be used for each pixel is not stored directly as bined on the screen to form a dual playfield display. If
 part of the bitplanes in memory, but is rather stored in a playfield 1 has a higher priority than playfield 2, the
 color table, previously referred to as the color palette. color for each pixel element is selected in display prior
 Thirty-two color registers 359 are contained on the ity control logic 337 by utilizing the color registers
 display encoder chip 420, and consist of a set of 12-bit designated by the odd bitplanes of playfield 1. How
 registers, each of which is selectable by one of 32 lines ever, if any pixels on the screen are placed in the trans
 from the color select decoder 357. Thus, any particular 10 parent mode (all bits are zero) by the odd bitplanes for
 pixel on the display can have any one of 32 different playfield 1, then the pixels will be colored using the
 colors. The contents of each of the 32 registers are color register designated by the even bitplanes associ
 selected by the user. The 12 bits contained in each regis ated with playfield 2. If the bitplanes for both playfields
 ter allow selection from a total of 4096 possible colors select the COLORO register for the same pixel, that
 for each color register. The COLORO register is always 15 pixel element will be colored with the background
 reserved for the background color of the screen. The color contained in the COLOR0 register.
 background color is the color which shows in any area            In order to simultaneously display more colors than
 on the display when no other objects are present, since the 32 possible choices stored in the color registers 359,
 all other objects have a higher priority than the back there is a special hold-and-modify mode. The mode is
 ground.                                                    20 selected using a bit within the bitplane control registers
    In order to select the color of a particular pixel from 355. In this mode, the system interprets the bitplane data
 a palette of more than two colors, there must be more in a different manner. As described previously, each
than a single bit in RAM 401 corresponding to each color register 359 contains 12 bits that designate a par
pixel displayed on the screen so that one of several color ticular color. An RGB color monitor is driven directly
 registers can be selected. If only one bitplane is used to 25 by an RGB (red, green, blue) color input signal. An
specify the colors of a playfield, each pixel in that play RGB color signal is virtually three monochrome sig
field can only have the color specified in color registers nals, separately driving the red, green, and blue guns of
COLORO and COLOR1. Additional color choices for                a raster display. When using normal resolution, the 12
the pixels become available when several bitplanes are bits of the color registers are interpreted such that bits 0
combined in order to specify the color register for each 30 through 3 designate the intensity level for the blue elec
individual pixel. When several bitplanes are combined tron gun, bits 4 through 7 correspond to the green elec
in order to specify the color of the onscreen pixel ele tron gun, and bits 8 through 11 correspond to the red
ments, the bits from each are combined into a longer electron gun. In hold-and-modify mode, the value in the
binary number which can select additional color regis color output circuitry for the previously displayed pixel
ters. Normally, for a single playfield, only five bitplanes 35 is held, and one of the three 4-bit parts of that value is
can be active in the Amiga system. The combination of then modified by the data in the first four bitplanes for
five binary bits for each pixel element allows a choice that pixel. In hold and modify mode, the bit combina
among 32 different color registers 359, each of which tions for a pixel element from bitplanes 5 and 6 are used
specifies a color. Each bitplane forms a separate block to modify the way in which the bits from bitplanes 1
of bits stored in RAM 401. However, the display inter through 4 are interpreted. The bitplane bus 333 and the
prets the bitplanes as if they were stacked, so that bits in 12 video outputs from the color registers 359 are input
corresponding positions in different bitplanes are com to the hold and modify circuitry 360, which has 12
bined by the display hardware to form a binary number video outputs. If the bits in bitplanes 5 and 6 for a pixel
which corresponds to a particular color register used to are set to zero, the first four bitplanes will be used to
provide the color for that pixel element. A bitplane 45 choose one of 16 color registers 359. For the three other
control register contains three bits which allow the user possible combinations of the two bits from bitplanes 5
to designate from 0 to 6 bitplanes for the display.            and 6, the color of the previous pixel displayed (to the
   The bitplane control registers 355 also contain a dual left of the current pixel) will be duplicated, except for a
playfield enable bit. In the dual playfield mode of opera 4-bit modification. The bits contained in bitplanes 5 and
tion, all odd numbered bitplanes are grouped together SO 6 determine whether the red, green, or blue portion of
as playfield 1 and all even numbered bitplanes are the display will be modified. The four bits in bitplanes 1
grouped together as playfield 2. For example, if six through 4 will then be used to replace the four (out of
bitplanes are specified and the dual playfield mode is 12) bits used in driving either the red, green, or blue gun
selected, eight different color registers can be desig of the display. Thus, in this mode, two parts (e.g., green
nated for any particular pixel by three bits combined for 55 and red) of the output from the color registers are held
each playfield, and the set of eight color registers is over from the previous pixel, and one part (e.g., blue) is
completely separate for each playfield.                        modified by the data contained in the bitplanes.
   A special case exists when the bitplanes contain all           Each line of pixels that is displayed on a television
Zeros for a particular pixel in either playfield 1 or play screen is formed from the overlap of one or more bit
field 2. The designation of all zeros for a pixel means planes containing bits associated with each particular
that the playfield is in transparent mode. (The COLORO pixel. Each bitplane, in turn, is formed from blocks of 16
register contains the background color.) Wherever the bit data words in consecutive locations in random ac- .
bit combination in either playfield is set for transparent cess memory 401. Each line of a bitplane consists of a
mode the display will show the color of whatever is sequence of data words, with the most significant bit of
"behind' (has lower priority than) the particular play 65 each data word relating to the leftmost pixel to appear
field (e.g., the other playfield, a sprite, or the back on the display of pixel elements. Each memory word is
ground color). The user can designate whether certain at a sequentially increasing memory address as one
objects are to be placed in front of or behind each other moves from left to right across the display. If the entire
                                                     4,874,164
                           21                                                            22
bitplane corresponds to pixels that will all be displayed,    ters 138 contains a value corresponding to the starting
then the leftmost pixel displayed on any horizontal line      memory address for that line plus 20. A modulo of 20
corresponds to a bit contained in a memory word at an         words must be added to this pointer using modulo regis
address one greater than the address of the word con          ter 131 and adder 137, so that when the data fetch for
taining the bit corresponding to the last pixel on the       the next horizontal line begins, the next 20 words in
right of the horizontal line displayed immediately           memory (corresponding to the part of the playfield
above. Within each data word, each bit represents a picture that is to the right or left of what can be dis
single pixel on the screen. The sequence of bits stored in played on the 320 available pixels at that particular
memory defines a two-dimensional plane of bits having instant) will be skipped. In this manner, the address of
one bit for each x and y position defined on the display, O the data not used in the current display is not placed by
referred to as a bitplane. Each bitplane as a whole pro the generator 45 on the RAM address bus 406. When
vides one bit for each possible x-y coordinate on the the high resolution mode is being used to display the
Scree                                                        playfields, 40 words of data must be fetched for each
   In order to display the background color and one or line instead of 20, and the modulo is 40 when the bit
two playfields on the screen, the Amiga system must be 15 plane is double the window size.
given the starting address during the vertical blanking         The system can be directed to display another portion
time for the data block for each of the bitplanes to be (e.g., the right half) of the picture defined by a bitplane
used. The start of the bitplane data is specified using that is larger than (e.g., twice) the size of the allowable
pointers contained in the pointer registers 138 of FIG. 4, display window. In such a case, a different pointer value
with one register existing for each of the six possible 20 is loaded into the pointer register 138 for that bitplane
bitplanes. The bitplane pointers are address pointers when the first bit is fetched for display of the upper left
which point to the starting address within-RAM 401 at pixel on the screen (during vertical blanking). To dis
which the data for a specific bitplane actually starts. play only the right half of a picture defined by bitplanes
The pointers in the registers 138 are 19 bits wide and are with 640-bit wide horizontal lines, the value of the
dynamic. Once the fetch of bitplane data begins during 25 pointer must be 20 words (320 bits) higher than the
DMA cycles, the pointers in registers 138 are continu starting address when only the left half of the picture is
ously incremented using adder 137 to point to the ad displayed. In this case, the modulo would remain at 20
dress of the next word in RAM 401 to be fetched. The         to prevent the addressing of data related to the left half
address of the data being accessed is then placed on the of the picture after each line is scanned.
DRA bus 406 by the RAM address generator 45 of the 30 The modulo stored in the bitplane modulo registers
Agnus chip 410. When the electron beam for the televi 131 is also used in producing an interlaced picture. A
sion screen reaches the last pixel to be displayed on a frame bit generated by the video beam counter 117 can
horizontal line (as determined by the beam count), it be loaded into a control register and read during the
will have fetched the last data word for that line. Each     vertical blanking routines of the operating system. De
pointer for each of the bitplanes is then adjusted by the 35 pending on the state of this bit, the system will produce
modulo amount contained in the modulo registers 131, either an odd frame or an even frame. Based on the
which is added to the pointer value stored in registers value of this bit, for odd frames the vertical blanking
138 using the adder 137. The addition of the modulo routines will load the bitplane pointer register 138 with
amount ensures that the next data word fetched will be       an address corresponding to line one, whereas for even
the word in memory corresponding to the leftmost pixel frames an address corresponding to data related to line
to be displayed on the next line of the screen. Separate two is loaded. The copper 47 skip instruction can be
modulo amounts can be used for the even and odd bit          utilized to achieve this. The display of alternate lines of
planes and stored in two modulo registers 131.               a complete picture contained in memory during alter
  As described previously, there are 320 pixels in each nate frames of the display requires setting the modulo
horizontal line in normal resolution mode. Each data 45 number in registers 131 equal to the total number of
word consists of 16 bits, so that 20 data words contain      words in memory relating to a single horizontal line
ing 320 bits are sufficient for each bitplane to contain all plus the normal value associated with the modulo (the
the data corresponding to one horizontal line of pixels number of words by which the data in memory defining
being displayed. If the size of the bitplane is exactly the a particular horizontal line exceeds the number of pixels
same as the size of the display window, then zero is 50 that are displayed on the screen at any one time.) If the
loaded into the modulo register 131. In this case, the "picture' stored in memory is defined as 400 lines long,
number of bits stored in RAM 401 is exactly the same as the 200 odd numbered lines are shown during one
the number of pixels which will appear on the screen.         frame, and the other 200 even numbered lines are shown
As each data word for the bitplane is fetched as the during the next frame to form the complete picture. The
electron beam travels horizontally along the screen, the 55 scanning circuitry vertically offsets the start of every
pointer for that bitplane is incremented by one by adder other field by half a scan line in interlaced mode. For
137. Thus, after each horizontal line is scanned by the odd frames, the pointer loaded in the pointer register
beam, the value (in words) stored in the pointer register 138 for a bitplane during the vertical blanking interval is
138 when the data fetch for the next line is begun will set at some starting memory address. Then, for even
exceed the pointer value when the previous line was frames, the value of the pointer loaded in the pointer
begun by 20. However, if, for example, the bitplane has register 138 at the beginning of the scan of an even
exactly twice the number of bits per horizontal line as frame corresponds to the original starting memory ad
the number of pixels to be displayed, a modulo of 20 dress plus the total number of words in memory con
Words must be used to assure that the data used togen taining bits relating to a single horizontal line.
erate the colors for the next line of pixels are the bits 65 To create a playfield that is the same size as the televi
relating to the next horizontal line. After displaying the sion screen, a width of either 320 pixels or 640 pixels
last pixel on a horizontal line, the pointer corresponding (high resolution) is chosen. The height can be either 200
to that bitplane in one of the six bitplane pointer regis lines or 400 lines (interlaced mode). The actual size of
                                                    4,874,164
                           23                                                           24
 the on screen display, however, can be further adjusted        One of the features of the Copper 47 is its ability to
 by defining a window size. Nothing will be displayed wait for a specific video beam position, then move data
 outside of the defined display window, including play into a system register. During the wait period, the Cop
 fields and sprites. The display window size is defined by per 47 examines the contents of the video beam position
 specifying the horizontal and vertical positions at which 5 counter 117 directly. Thus, while the Copper 47 is wait
 the display window starts and stops. The resolution of ing for the beam to reach a specific position, it does not
 vertical start and stop is one scan line; the resolution of use the data bus 404 at all. Therefore, the data bus 404
 horizontal start and stop is one low resolution mode is freed for use by other DMA channels or by the mi
pixel. The display window start register controls the croprocessor 402. When the wait condition has been
 display window starting position. Both the horizontal 10 satisfied, the Copper 47 steals memory cycles from
and vertical components of the display window starting either the Blitter 67 or the processor 402 to move the
positions are loaded into this register, which is located specified data into the selected special purpose registers.
among the bitplane control registers 55 on the Agnus The copper 47 is a two cycle processor that requests the
chip 410, by either the processor 402 or the Copper 47. bus only during odd numbered memory cycles. This
Similarly, a display window stop register exists on the 15 prevents collision with audio, disk, refresh, sprites, and
Agnus chip 410 and is loaded with the horizontal and most low resolution display DMA access, all of which
vertical components of the display window stopping use only the even numbered memory cycles. The Cop
position. The stopping position, like the starting posi per 47 therefore needs priority over only the processor
tion, is interpreted in low resolution non-interlaced 402 and the Blitter 67.
mode, even if the high resolution or interlaced modes 20 The Copper 47 instruction list is sufficient to accom
are selected.                                                plish all the register resetting done during the vertical
   After the size and position of the display window is blanking interval and the register modifications neces
defined using the display window start and stop regis sary for making midscreen alterations. For example, the
ters, the onscreen location for the data fetched from pointers for the odd and even bitplanes used in playfield
memory must be identified. This is done by loading the 25 displays an the sprite pointers must be rewritten during
horizontal positions where each line starts and stops to the vertical blanking intervalso that the data relating to
a data fetch start register and a data fetch stop register the top left of the screen will be retrieved when the
located among the bitplane control registers 55. Unlike display starts again. This can be done with a copper
the display window registers, which have a one pixel instruction list that does the following: (1) wait until the
resolution (low resolution mode), the data fetch regis 30 video beam reaches the first line of the display; (2)
ters have a 4 pixel resolution because only five bits are MOVE starting address in RAM 401 for odd bitplane
used in either register to specify the beginning and end data to the first bitplane pointer register; (3) MOVE
ing position for the data fetch. The hardware requires starting address for even bitplane data to second bit
some time after the first data fetch before it can actually plane pointer register; (4) MOVE data to first sprite
display the data. As a result, there is a difference be 35 pointer register; etc. As another example, the color
tween the value of window start and data fetch start,        registers can be reloaded with bits specifying the dis
and the registers control the horizontal timing of the play of different colors in the middle of the display of a
bitplane DMA data fetch. In low resolution mode, the screen. Thus, the program instruction list for the Cop
difference is 8.5 clock cycles; the difference is 4.5 clock per 47 would wait for the first line of the display, then
cycles in high resolution mode. As described previ move a series of 12 bit codes into several of the color
ously, the bitplane address pointers stored in pointer registers, wait for a subsequent line of the display (such
registers 138 are used to fetch the data to the screen. as the first line corresponding to a reuse of a particular
Once the data fetch begins, the pointers are continu sprite processor), and then move 12 bits of data specify
ously incremented to point to the next word. The data ing a new set of colors into some of the color registers
fetch stop register defines when the end of a horizontal 45 previously loaded during the first line of display.
line is reached, at which point the bitplane run signal is      The Copper 47 fetches its instructions by using its
off and the modulo contained in the modulo register 131 program counter and increments the program counter
for that bitplane is added to the pointer for that bitplane. after each fetch. The Copper 47, however, has two
Thus, the pointer is adjusted to contain the address of jump strobe addresses, jump 1 and jump 2. When an
the first word of data to be fetched for the next horizon 50 attempt is made to write to either the jump 1 or jump 2
tal line. There are two modulo registers, the bitplane1 strobe addresses, the program counter of the Copper 47
modulo register for the odd numbered bitplanes (or for is loaded with a new address. The Copper 47 has a first
playfield 1 when operating in the dual playfield mode) and a second location register 129, which contain RAM
and bitplane2 modulo register for the even numbered addresses. Whenever a jump strobe address is written,
bitplanes (or for playfield 2 when operating in the dual 55 the address contained in the corresponding location
playfield mode).                                             register is loaded into the copper program counter
   To start the display of the playfields, the pointers for (pointer register) using adder 137 and the gate inhibit
the bitplanes must be set and the bitplane DMA is signal. This causes the Copper to jump to the address
turned on. The bitplane DMA is turned on by setting a specified in either the first or second location register
bit in a DMA control register. Each time the playfield 129, and to execute the instruction contained at that
is redisplayed after the vertical blanking interval, the RAM address. The instruction fetch then continues
bitplane pointers must be reset. Resetting is necessary sequentially until the Copper 47 is interrupted by an
because the values in the pointer registers have been other jump address strobe. At the start of each vertical
incremented to point to each successive word in mem blanking interval, no matter what the Copper is doing,
ory for each set of bitplanes and must now be repointed 65 the Copper is automatically forced to restart its opera
to the first word for the next display. Program instruc tions at the address contained in the first location regis
tions for the Copper 47 are used to perform this opera ter. The Copper can also write to its own location regis
tion as part of a vertical blanking task.                    ters and then to its strobe addresses to perform pro
                                                      4,874,164
                           25                                                                26
grammed jumps. Thus, the Copper can move a new                    The term Bitter stands for block image transferer.
address into the second location register. Then, a subse       The primary purpose of the Blitter 67 is to copy (trans
quent move instruction executed by the Copper that             fer) data in large blocks from one memory location to
addresses the jump 2 address causes the new address in         another, with or without further processing. The opera
the second location register to be strobed into the cop        tions it performs after its registers are set up are consid
per's program counter. At power on or reset time, the erably faster than those performed by the microproces
first and second location registers of the copper must be sor 402. The Blitter 67 is very efficient at copying
initialized and the jump strobe address must be written blocks of data because it needs to be told only the start
to so that a known start address and known state is ing address in RAM 401, the destination address in
ensured before the copper DMA is first turned on. 10 RAM 401, and the size of the block. It will then auto
Then, if the contents of the first location register are not matically move the data block, one word at a time,
changed, the copper will restart at the same location whenever the data bus 404 is available. The Blitter will
every time vertical blanking occurs for each subsequent signal the processor 402 with a flag and an interrupt
video screen. One bit in a DMA control register is set in when the transfer has been completed.
order to enable coprocessor DMA operations.                 15    The Blitter performs its various data fetch, modify,
   In order to obtain a background display that moves, a and store operations through DMA sequences, and it
playfield larger than the display window is stored in shares memory access with the other devices in the
memory and scrolled. When using dual playfields, each Amiga system. Disk DMA, audio DMA, bitplane
playfield can be scrolled separately. In horizontal DMA, and sprite DMA all have the highest priority
scrolling, one additional word of data must be fetched 20 level. Each of these four devices is allocated a group of
for the display of each horizontal line, and the display of time slots during each horizontal scan of the video
this data must be delayed. In vertical scrolling, the beam. If a device does not request one of its allocated
starting address loaded into the bitplane pointers is time slots, the slot is open for other uses. First priority
increased or decreased by an integral multiple of the is given to these devices because missed DMA cycles
amount of words taken up by a horizontal line in mem 25 can cause lost data, noise in the sound output, or inter
ory. This causes a lower or higher part of the picture to ruptions in the display on the screen. The Copper 47 has
be displayed after each vertical blanking interval. To the next priority because it must perform its operations
accomplish vertical scrolling, during each vertical at the same time during each display frame to remain
blanking interval, the Copper must increase or decrease synchronized with the video beam sweeping the screen.
the value of the pointer stored in the bitplane pointer 30 The lowest priorities are assigned to the Blitter 67 and
register 138 by an amount large enough to ensure that the microprocessor 402, in that order. The Blitter 67 is
the display begins at least one horizontal line later or given the higher priority because it performs data copy
earlier each time. For either type of scrolling, the Cop ing, modifying, and line drawing operations much faster
per 47 can be used during the vertical blanking interval than the microprocessor 402. During scan of a horizon
to reset pointers and data fetch registers. For a low 35 tal line, there are typically 227.5 memory access cycles,
resolution display in which only 20 words of data is each of which is approximately 280 nanoseconds in
used for each horizontal line, the starting address loaded duration. Of this time, 226 cycles are available to be
into the pointer register 138 by the Copper 47 would be allocated to the various devices needing memory ac
changed by a multiple of 20 words during each vertical cess. The memory cycles are allocated as follows: four
blanking interval.                                             cycles for memory refresh (assigned only to odd num
   The playfields can be scrolled horizontally from left bered cycles); three cycles for disk DMA (assigned only
to right or vice versa on the screen. Horizontal scrolling to odd numbered cycles); four cycles for audio DMA
is controlled by specifying the amount of delay prior to (assigned only to odd numbered cycles, one word per
display of the pixels. The delay occurs when an extra channel); 16 cycles for sprite DMA (assigned only to
word of data for a horizontal line is fetched but is not 45 odd numbered cycles, two words per channel); and 80
immediately displayed. The additional data word is cycles for bitplane DMA (can be assigned only to odd
located to the left of the left edge of the display window numbered cycles if display is low resolution and con
and is retrieved before normal data fetch begins. As the tains four or fewer bitplanes). The microprocessor 402
beam scans to the right, however, the bits in this addi uses only the even numbered memory access cycles.
tional data word are used to define the color of the 50 Normally, during a complete processor instruction
pixels appearing on screen at the left hand side of the time, the processor 402 spends about half of the time
window, and data formerly used to color pixels appear doing internal operations and the other half accessing
ing on the right hand side of the screen no longer ap memory. Therefore, by allocating every other memory
pears during the display. For each pixel of delay speci cycle to the 68000 processor, the processor 402 can run
fied, the onscreen data shifts one pixel to the right after 55 at full speed because it appears to the processor that it
each vertical blanking interval. The greater the delay has memory access all of the time. Thus, the 68000 runs
utilized, the greater the speed of scrolling of the display. at full speed most of the time if there is no Blitter DMA
Up to 15 pixels of delay can be specified by loading a interference. If cycles are missed by the 68000, it waits
bitplane control register 327 with four bits of data speci until its next available memory cycle before continuing.
fying the delay for playfield 1 and four bits of data 60 However, if there are more than four bitplanes being
specifying the delay for playfield 2. Thus, in horizontal displayed, or a high resolution display is used, bitplane
scrolling, the data fetch start register must be loaded DMA will begin to steal cycles from the 68000 during
with a beginning position for the data fetch that is 16 the display. If, for example, four high resolution bit
pixels (one extra word) before the unscrolled beginning planes are specified, bitplane DMA needs all of the
position for data fetch, the modulo for the playfield 65 available memory time slots during the display time
must be increased by one word, and the number of bits (bitplane run signal is on) in order to fetch the 40 data
of delay must be loaded into a bitplane control register words needed for each line for each of the four bit
327.                                                           planes. This effectively locks out the processor 42 as
                              27
                                                      4,874,164
                                                                                           28
 well as the Blitter 67 and Copper 47 from any memory           A Blitter size register included among control regis
 access during the display. During the display time for a ters 63 is loaded with the width and height of the win
 four bitplane low resolution display, 80 odd numbered dow being operated on by the Blitter. Ten bits in this
 time slots are reserved for the bitplane DMA and the 80 register define the height of the Blitter operation, up to
 even numbered time slots are all available for the pro a maximum of 1024 lines. Six bits in this register define
 cessor 402. For a display of a six bitplane low resolution the width of the Blitter operation, up to a maximum of
display, bitplane DMA steals half of the 80 even num 64 words or 1024 pixels. Loading data into the Blitter
bered slots during the display because 120 time slots are size register starts operation of the Blitter, and is done
 needed to fetch 20 data words for six bitplanes. No last after all pointers and control registers have been
 memory time slots are available during display of a four 10 initialized.
bitplane high resolution display because all 160 time           Instead of simply retrieving data from a single source,
slots are needed to fetch the 40 data words for each of      the Blitter can retrieve data from up to three sources as
the four bitplanes.                                          it generates a result for a possible destination area.
   The Blitter 67 normally has a higher priority than the These sources are usually one bitplane from each of
processor 402 for DMA cycles. If given the chance, the 15 three separate graphic images. The Blitter logic opera
Blitter would steal every available memory cycle, tion is defined by describing what occurs for all of the
blocking the processor 402 from bus access. By setting possible combinations of one bit from each of the three
a bit in a DMA control register, the Blitter will be given sources. The eight possible data combinations of three
priority over the processor 402 for every available bits are referred to as MINTERMS. For each of the
memory cycle. However, if the bit is not set, the Blitter 20 eight input possibilities, the value of the bit output to the
67 will be forced to release the data bus 404 to the pro corresponding destination in RAM 401 must be speci
cessor 402 for one cycle if the processor 402 is unsatis fied. One of the Blitter control registers 63 is loaded
fied for three consecutive memory cycles.                    with eight bits used as logic function MINTERM select
   The Blitter uses up to four DMA channels. Three lines. The setting of these eight bits specifies one of 256
DMA channels are dedicated to retrieving data from 25 possible logic operations to be performed on the data
RAM 401 to the Blitter 67, and are designated as source from three sources during the Blitter operation.
A, source B, and source C. The one destination DMA              The Blitter 67 is extremely efficient in performing
channel is designated as destination D. A Blitter control bitplane animation because it can logically combine data
register 63 is loaded with data from data bus 404 to bits from separate image sources during a data move.
indicate which of the four DMA channels are to be 30 For example, it may be desired to move a predrawn
used, with four bits needed in all to independently en image of a car in front of a predrawn image of a build
able each of the four channels. Each of the Blitter          ing. To animate (move) the car, the first step is to save
source and destination channels has its own memory a window containing the background image where the
pointer register 138 and its own modulo register 131. car will be placed. Data containing the complete outline
This allows the Blitter to move data to and from identi 35 (mask) of the car is created somewhere in memory and
cal rectangular windows within larger playfield images can be designated as source A, the data containing one
that can be of different sizes for each of the sources and   of the bitplanes defining the color for the car object
for the destination block in memory. The pointer regis itself can be designated as source B, and the data con
ters 138 for the Blitter channels are used to point to the taining the background (or building) can be referred to
address in RAM 401 where the next word of source or          as source C. Next, a temporary location T in RAM 401
destination data is located. Similar to the bitplane opera is designated the destination for the background of
tions described previously, the Blitter 67 uses modulos source C where the car is going to be placed. The AC
to allow manipulation of smaller windows within larger logic operation is selected, which will save the back
images stored in memory. When the modulo amount ground by copying it to a new destination at all points
stored in the corresponding modulo register 131 is 45 where the outline mask of the car (A) and the back
added to the value in the appropriate pointer register ground (C) exist at the same location. The next step is to
138, the address pointer will identify the start of the next copy the car in its first location. The destination se
horizontal line after the last word in the window on the     lected this time is the same as the block of data contain
previous line has been processed. When operating on ing the background (C). The AB+ AC operation is used
data words contained on the same horizontal line of a 50 to indicate that the window will now contain the car
window of selected size, the address contained in the       data (B) wherever the car outline mask (A) exists, but
pointer register 138 will be incremented by one word          will keep the previous background data (C) wherever
each time. It is possible to specify blocks of data for the the car outline mask does not exist (A). If the car was
sources and destination that overlap. In such a case, it is already present somewhere on the display, the old back
possible that the Blitter will write to a particular mem 55 ground image which the car covered prior to moving
ory address within the destination block before the data must be restored at the location from which the car was
at that same address was read by the Blitter as the moved before copying the background that will be
source. To prevent such data destruction, it is possible covered next. The background (C) is the destination
to either increment or decrement the pointer values as and the operation AT is used, where the source T is the
the data is being processed using an invert instruction temporary destination at which the background where
signal. For example, the value in the pointer registers the car was previously placed was stored using the AC
should be decremented and the Blitter should operate in operation. This AT logic operation replaces the back
descending mode if there is an overlap between the ground (C) with the saved background at all places
source and destination blocks of data and it is desired to  where the car outline mask (A) existed. If the data and
move data toward a higher address in RAM 401. The 65 the mask is shifted to a new location and the logic oper
descending or ascending mode of operation is selected ations above are repeated continuously by the Blitter,
by loading a bit contained within the Blitter control the car will appear to move across the background. The
registers 63.                                               logic operation in which the new image is created using
                                                       4,874,164
                            29                                                             30
the logic operation AB+AC is referred to as the                ing 15 Zeros and a single '1' as the most significant bit.
“cookie cut' operation.                                        This is the single bit which will be shifted into the cor
  In the example just described, the car image (B) and         rect position by the value in the A shift register 93
the car outline mask (A) must be shifted to a new posi         initially, then by the line-drawing hardware later in the
tion each time before the background is saved (AC) and         process. The 16 bits in the B data register 77 are used to
the car is placed (AB--AC). The movement of an image           indicate the texture of the line and are preloaded with
(B) across a background (C) can cause the edge of the all ones to create the solid lines required if the fill mode
image to land on any bit position within a 16 bit word. will be executed subsequently. Four bits in a Blitter
This creates a need for a high speed shift capability control register 63 are loaded with the bit position
within the Blitter 67. Accordingly, the Blitter contains 10 within the word at which the starting bit of the line
a barrel shifter 81 that is used with both the A and B          occurs. Three bits in a Blitter control register 63 are
data source registers 77 and 79. The shifter 81 can shift loaded with a value that selects one of eight octants
sources A and B from zero to 15 bits. It is a true barrel       used for line drawing. The eight octants are used to
shifter in that bigger shifts do not take more time than divide a two dimensional Cartesian plane into eight
smaller shifts, as they would if performed by the micro 15 regions to define the direction of the line for purposes of
processor 402. Thus, even though 16 pixels must be line drawing. The Blitter size register is used to control
addressed at a time as each word in a bitplane is fetched, the line length and starts the line draw when data is
the shifter 81 allows movement of images on pixel written into it. Ten bits designate the height and allow
boundaries. The amount of the shift for each of the             for lines extending up to 1024 pixels, while six bits indi
sources is set by loading four bits into the Blitter control 20 cating the number of words in the width must always be
registers 63 for the A source and four bits for the B set equal to two. The slope of the line is defined by
SOC,                                                            loading the difference in bit position between the start
   The Blitter 67 can mask the left most and right most ing and ending points of the line in the A modulo regis
data word in the selected window from each horizontal           ter (horizontal change) and B modulo register (vertical
line. Mask registers 83 and 85 are provided for the first 25 change). The Blitter pointer register 138 for source A is
and last words on every horizontal line of Blitter data used as an accumulator when in line mode. The pointer
for source A. This allows logic operations on bit bound registers for the source C and destination D must be
aries from both the left and the right edge of a rectangu preloaded with the starting address of the first horizon
lar region. Only when there is a 1 bit loaded in the first tal line. The modulo registers for the C source and D
word mask will that bit from the first word of source A 30 destination are both preloaded with the width of the
be utilized in the logic operations performed by the screen into which the line is being drawn.
Blitter. In a similar way, the last word mask 85 masks            The Blitter control register 63 during a line draw
the right most word of the source A data. Thus, it is mode is always loaded with the same logic function
possible to perform operations on a rectangular block of minterm select bits. The logic function selected Blitter
data with left and right edges occurring between word 35 operation during line draw mode is the moving into the
boundaries. If the window is only one word wide, the destination of AC+ABC. The A source data register
first and last word masks overlap and bits from the 77, as described above, is loaded with only a single bit in
source A word will be utilized only at bit positions the data word, a one. Therefore, this operation on the
where both masks contain ones.                                  display field (C) will leave most bits in the bitplanes
   The Blitter can sense whether any “1” bits are present unchanged, because for at least 15 of the 16 bits in each
as a result of a logic operation on source data. This word, the destination will be loaded with the existing bit
feature can be used for hardware assisted detection of a   values in the C source data register 89 (AC). If the line
collision between two images. The operation AB can be draw is to be followed by an area fill, untextured lines
performed, and if the images A and B do not overlap, a are required, so that the B source data register 79 con
Zero flag will be set in a Blitter DMA status register. 45 tains only ones. Therefore, for the one bit per word in
When the Blitter is doing only zero detection and not the A source register 77 that is a one, the bit value
being used to generate a destination image, time and bus contained in the C source data register 89 will be in
cycles can be saved by disabling the destination channel verted (ABC). For each subsequent horizontal line, the
by not setting the appropriate bit in the Blitter control Blitter hardware automatically moves the “1” to the
registers 63.                                                50 correct position in the data words being stored in the A
   In addition to copying data, the Blitter 67 can simul source data register 77. As a result, special lines with
taneously perform a fill operation during the copy. A one pixel on each horizontal scan line can be drawn by
restriction on the fill operation requires that the fill area the Blitter 67.
be defined by first drawing untextured lines that contain         A fill operation can be performed during other Blitter
only one pixel per horizontal line to set the boundaries 55 data copy operations. Prior to the area fill, a Blitter line
for the fill. A special line draw mode executed by the draw is first performed to provide two vertical lines,
Blitter can accomplish this line drawing operation. The each one bit wide, on the display. The fill operation
Blitter can draw ordinary lines of any angle and can also operates correctly only in the descending mode (from
apply a pattern to the lines it draws. A bit is set in the higher memory addresses to lower memory addresses).
Blitter control registers 63 in order to indicate the Blit 60 Only one source and the destination D is required. The
ter is to operate in line draw mode. In order to ensure pointers for the source and the destination in pointer
that the lines being drawn are one pixel wide, as re registers 138 should be set to the same value, which will
quired for a subsequent area fill, another bit must be set
                                                       be the address of the last word of the enclosing rectan
in the Blitter control register 63 to designate a single bit
                                                       gle of the window in RAM 401 since the operation is
per horizontal line. The source A and source C are 65 performed in a descending direction. The modulo regis
utilized in conjunction with the destination D Blitter ters for the source and destination are loaded with the
DMA channels. The Blitter source A register 77 during difference between the number of words in a horizontal
line draw mode is preloaded with a 16 bit word contain line of the rectangle to be filled and the number of
                            31
                                                       4,874,164
                                                                                             32
words per horizontal line taken up in memory by the             organized into pairs and each pair uses one of three
bitplanes. The Blitter size register is then loaded with 10     color registers or else selects the transparent mode. For
bits setting the number of vertical lines in the display        each of the odd numbered sprites, the associated control
window and 6 bits specifying the number of words in             register 37 contains a bit that can be set in order to
each horizontal line. Writing to the Blitter size register      attach an odd and an even numbered sprite to pair the
will start the operation of the Blitter. A Fill Carry In        data for both sprites in color interpretation. The two
control bit is loaded into a Blitter control register 63 to     sprites will remain capable of independent motion.
indicate the starting fill state beginning at the right most     However, if their edges overlay one another at any
edge (descending mode) of each line. If the Fill Carry          particular pixel location, a greater selection of colors is
 In bit is set to a one, the area in the source area outside 10 possible because all four bits are then utilized in select
 the lines is filled with ones and the area inside the lines    ing one of 16 color registers.
 is left with zeros. If the Fill Carry In bit is a zero, the       The memory address for the data defining each sprite
 area between the lines is filled with ones. The Blitter        must be written into the proper pointer registers 138
 control register 63 also is loaded with bits indicating during the vertical blanking interval before the first
 whether an inclusive fill or an exclusive fill is to be 15 display of the sprite. Normally, the sprite pointer regis
 utilized. When the exclusive fill is enabled, the outline ters are loaded during the vertical blanking interval by
on the trailing edge of the fill (left side) is excluded from the Copper 47. The values in the sprite pointer registers
 the resulting filled area. Enabling the exclusive fill are dynamic and are incremented using the adder 137
 mode is used to produce sharp, single pixel vertices.          and point first to the memory address containing the
    Sprite objects are graphic objects that can be moved 20 start data to be loaded into the position register, then the
quickly on the screen, without moving their image loca next address containing vertical stop data to be loaded
 tion in memory. In contrast, bitmapped objects have a into the sprite (vertical stop) control register 155, then
position on the display screen that is directly related to the following addresses containing pairs of data words
their location in RAM 401, and in order to move them, specifying the color selection information needed for
the object image stored in memory must be erased and 25 each horizontal line of the sprite. After the data words
 rewritten in a different location. This can be very time describing the color selection in the last horizontal line
consuming. The sprites used in the Amiga system are in the sprite, two data words indicate the next usage of
moved with extra hardware, such as horizontal position this sprite and comprise the start and stop data for reuse
registers 343, vertical position registers 37, a horizontal of the sprite. This last word pair contains all zeros if the
position comparator 341, a vertical position comparator 30 particular sprite processor is to be used only once verti
39, and sprite data buffer registers 345. To move a cally in the display frame. During the vertical blanking
sprite, the values stored in the position registers are interval, the sprite pointers must be rewritten into the
simply changed. The vertical position circuits are lo pointer registers. The video beam counter 117 contains
cated on the Agnus chip 410. The data buffers and the a count indicating the current location of the video
horizontal position circuits are located on the Denise 35 beam that is producing the picture. The sprite vertical
chip 420.                                                       position comparator 39 and horizontal position compar
    The location of a sprite is defined by specifying the ator 341 compare the value of the beam counter to the
coordinates of its upper lefthand pixel. In the Amiga value of the start position in the sprite position registers
system, each sprite forms a rectangle on the display 153 and 343. Writing to the sprite position and control
with a fixed width of 16 pixels (one data word) and a 40 registers disables the horizontal comparator circuitry
variable height. A sprite therefore consists of a series of 341. This prevents the data registers 345 from sending
 16 bit words in a contiguous memory area. To create a any ouput to the serializers 347 and to the sprite bus 349.
sprite data structure, the bits in the position registers 153 If the beam has reached the horizontal line on which the
and 343 for that particular sprite (there are eight sprites uppermost pixel of the sprite is to appear, the vertical
available in all) are loaded with eight bits that specify 45 position comparator 39 causes the sprite DMA control
the vertical start position and eight bits that specify the ler 41 to have data registers 345 for that sprite loaded,
horizontal start position of the pixel at the upper left which enables the horizontal comparator 341. This
hand corner of the sprite. Next, eight bits in the vertical enables output by the serializers 369 for that sprite to
stop location register 155 for that particular sprite are the sprite bus when comparator 341 indicates the hori
loaded with the vertical stop position for the particular 50 zontal start position has been reached. Each of the 16
sprite (also referred to as a sprite control register). bits of a sprite data word is individually sent to the color
There is one position and one control register for each select circuitry at the time that the pixel associated with
sprite, or a total of eight of each for the entire Amiga that bit is being displayed on screen. Each parallel to
system. Each sprite also is associated with two data serial converter 369 begins shifting the bits out of the
registers containing the bits defining the color registers 55 converter, with the most significant bit first. The shift
utilized for each of 16 pixels on a particular horizontal occurs once during each low resolution pixel time and
line of the sprite. The two data registers for each sprite continues until all 16 bits have been transferred to the
allow two bits to be used in defining the color register sprite bus 349. The sprite bus goes to the priority cir
associated with any particular pixel in the sprite. There cuitry 337 to establish the priority between sprites and
fore, four possible registers are available. When both playfields in selecting a color register. The sprite DMA
bits are set at zero for a particular pixel, this is inter channel examines the contents of the sprite position and
preted as "transparent' and the color defined by the control registers to determine how many lines of sprite
data associated with a playfield or sprite having a lower data are to be fetched, with two data words fetched per
priority can be displayed. Any other binary number each horizontal scan line occurs during a horizontal
points to one of the three color registers assigned to that 65 blanking interval. The fetch and store for each horizon
particular sprite DMA channel. The eight sprites use tal scan line occurs during a horizontal blanking inter
system color registers 17-19, 21-23, 25-27, and 29-31. val. When the data words are fetched and written into
For purposes of color selection, the eight sprites are the data registers, this arms the sprite horizontal com
                                                       4,874,164
                            33                                                               34
parators 341 and allows them to start the output of the         playfield 1 but disappear behind playfield 2 while play
sprite data to he screen as soon as the horizontal beam         field 2, in turn, has lower priority than playfield 1 and is
count value matches the value stored in the sprite hori         not visible behind it.
zontal position register 343. When the vertical position          The collision control register 351 contains the bits
of the beam counter is equal to the vertical stop value         that define certain characteristics of collision detection.
contained in the sprite control register, the next two          Collisions are detected when two or more objects at
words addressed by the sprite pointer registers and             tempt to overlap in the same pixel position. This will set
fetched from memory will be written into the sprite a bit in the collision data storage register 353 if the
position and control registers instead of being sent to collision control register indicates that particular over
the data registers 345. These words are interpreted by 10 lap will cause a collision. Fifteen bits in the collision
the hardware in exactly the same manner as the original storage register are utilized to indicate whether any of
words first loaded into the position and control regis several types of overlaps has occurred: e.g., one sprite
ters. By loading the position register with a vertical to another sprite, even bitplanes to odd bitplanes, even
starting position that is higher than the current beam bitplanes to a certain sprite, or odd bitplanes to a certain
position, the sprite can be reused during the same dis 15 sprite. The collision control register contains bits that
play field.                                                     specify whether to include or exclude the odd-num
   A sprite generated in the manner described above can bered sprites or specific bitplanes from collision detec
be moved by simply changing the vertical and horizon tion. Furthermore, other bits specify the true-false con
tal starting position and vertical stopping position dition of the bits in each bitplane that will cause a colli
loaded into the sprite position and control registers. If 20 sion. Thus, it is possible to register collisions only when
this position data is changed before the sprite is re an object collides with something of a particular color.
drawn, the sprite will appear in a new position and will          The above description of the invention is intended to
appear to be moving. Usually, the vertical blanking be illustrative of a single preferred embodiment.
period is the best time to change the position of the Changes can be made to the structures described herein
sprite. Each sprite DMA channel can be reused several 25 without departing from the features and scope of the
times within the same display field. The only restriction invention.                        co

on reuse of a sprite at a lower vertical position on the          What is claimed is:
display screen is that the last line of the prior usage of a      1. A personal computer system to provide video out
sprite must be separated by at least one horizontal scan put signals to a raster display, wherein an image consist
line from the top line of the next usage of the sprite. This 30 ing of a plurality of pixels if assembled on a screen of the
restriction is necessary because the time during this raster display by an electron beam scanning the screen,
horizontal scan line is needed to fetch the position and and wherein the visual characteristics of a pixel being
control words defining the next usage of the sprite. As scanned by the electron beam are determined by the
sprites move on the display screen, they can collide video output signals provided by the personal computer
with each other or with either of the two playfields. 35 system when the pixel is being scanned, and wherein the
The Amiga system contains special collision detection personal computer system comprises:
logic 335 to create special effects or to keep a moving           central processor means for executing program in
object within specific onscreen boundaries. Built in                 structions;
sprite video priority ensures that one sprite appears to          memory means including a plurality of addresses for
be behind the other when sprites are overlapped. The                 storing bit-mapped image data, wherein the visual
priority circuitry 337 gives the lowest numbered sprite              characteristics of a pixel are defined by bit-mapped
the highest priority and the highest numbered sprite the             image data stored in at least one address corre
lowest priority. Therefore, when two sprites overlap,                sponding to the pixel;
the image defined by the data for the lower numbered              data bus means coupled to the processor means and
sprite will be displayed except for pixel positions that 45          the memory means for transferring data;
are designated as being transparent, in which case the            address bus means coupled to the processor means
lower priority sprite data can be used to generate an                and the memory means for transferring an address
image.                                                               to the memory means;
  The priorities of various objects on the display can be         pointer means, coupled to the address bus means, for
controlled to give the illusion of three dimensions. For 50          selecting a plurality of source addresses in the
playfield priority and collision purposes only, sprites are          memory means as a plurality of sources of unpro
treated as four groups of two sprites each. The relative             cessed bit-mapped image data to be transferred on
priority of the sprites to each other cannot be changed.             the data bus means, and for selecting a destination
They will always appear on the screen with the lower                 address in the memory means as a destination of
numbered sprites appearing in front of (having higher 55             processed bit-mapped image data to be transferred
screen priority than) the higher numbered sprites. This              on the data bus means;
priority is wired into the display priority control logic         blitter means, coupled to the data bus means, for
337 In the bitplane priority registers 355, seven bits can           transferring a block of bit-mapped image data be
be loaded that will control the relative video priorities            tween the blitter means and the memory means,
of playfield 1, playfield 2, and the four pairs of sprites. 60       and for processing the block of bit-mapped image
Three bits are utilized to determine the relative priority           data, wherein the blitter means includes:
of playfield 1 with respect to the four pairs of sprites.            means for receiving from the data bus means un
Similarly, three more bits are utilized to establish the                processed bit-mapped image data stored in the
priority between playfield 2 and four pairs of sprites.                 memory means at the plurality of source ad
However, one more bit is utilized to determine which of 65             dresses;
the two playfields has higher priority than the other.               logic means, for executing a logical operation on
This allows for unusual visual affects on the screen.                  unprocessed bit-mapped image data simulta
Thus, it is possible to have sprites appear in front of                neously input from the receiving means for each
                               35
                                                      4,874,164
                                                                                            36
         of the plurality of source addresses, to generate dresses, and in which the shift means executes the se
         processed bit-mapped image data; and                 lected shift count.
      means for providing the processed bit-mapped               9. A personal computer system in accordance with
         image data to the data bus means for storage in claim 2, in which the blitter means further comprises
         the memory means at the destination address; means for selecting one of a plurality of logical opera
         and                                                  tions, and in which the logic means executes the se
   image display means, for receiving bit-mapped image lected logical operation.
      data stored in at least one address corresponding to       10. A personal computer system in accordance with
      a pixel, and for generating the video output signals claim 9, in which the means for selecting one of a plural
      determining the visual characteristics of the pixel. 10 ity of logical operations selects one of 256 possible logi
   2. A personal computer system in accordance with cal operations.
claim 1, in which the pointer means selects a first ad           11. A personal computer system in accordance with
dress, a second address, and a third address in the mem claim 9, in which the blitter means further comprises
ory means as a first source, a second source, and a third shift means for executing a shift operation on bit
source of unprocessed bit-mapped image data to be 15 mapped image data from at least one of the three source
transferred on the data bus means.                            addresses.
   3. A personal computer system in accordance with              12. A personal computer system in accordance with
claim 2, in which the image display means generates claim 9, wherein the image includes a background and
video output signals comprising RGB color signals.            an object on the background having an outline, and
   4. A personal computer system in accordance with 20 wherein the object is animated with respect to the back
claim 2, and further comprising blitter DMA controller ground, in which:
means for generating a blitter DMA request to prevent           the memory means includes at least one address A for
data from being transferred between the data bus means             storing data defining the outline of the object, at
and the central processor means at times when bit                  least one address C for storing bit-mapped image
mapped image data is transferred between the blitter 25            data defining the visual characteristics of the im
means and the memory means.                                        age, at least one address B for storing bit-mapped
   5. A personal computer system in accordance with                image data defining the visual characteristics of the
claim 2, wherein the image is assembled on the screen              object, and at least one address T for storing bit
by the electron beam scanning a plurality of horizontal            mapped image data defining the visual characteris
lines, and wherein the personal computer system further 30         tics of at least the portion of the background cov
comprises:                                                         ered by the object;
   size means for designating the width of a window of          the pointing means selects address A as a first source,
      bit-mapped image data being processed by the blit            address C as the second source, and address T as a
    ter means, wherein the window width is the num                 destination at a first time, selects address A as a first
      ber of addresses corresponding to each horizontal 35       source, address B as a second source, address C as
      line of the window; and                                    a third source, and address C as a destination at a
   modulo register means coupled to the pointer means            second time, and selects address as a first source,
      for storing a modulo amount, wherein the modulo            address T as a second source, and address C as a
      amount corresponds to the difference between the           destination at a third time; and
      window width number and the number of ad                 the selecting means selects a logical operation at the
      dresses corresponding to each horizontal line of the       first time that stores at address T at least the por
      image for at least one of the plurality of source          tion of the background to be covered by the object,
      addresses and the destination address; and                 selects a logical operation at the second time that
   wherein the pointer means selects a first address cor         stores at address C bit-mapped image data defining
      responding to one horizontal line of the window, 45        the visual characteristics of the object if the outline
      for at least one of the plurality of source addresses      of the object is present at address C and that saves
      and the destination address, by adding the modulo          at address C bit-mapped image data defining the
      amount to a last address corresponding to another          visual characteristics of the background if the out
      horizontal line of the window.                             line of the object is not present at address C, and
   6. A personal computer system in accordance with 50           selects a logical operation at the third time that
claim 5, wherein the receiving means receives a multibit         stores at address C bit-mapped image data defining
data word of unprocessed bit-mapped image data from              the visual characteristics of at least the portion of
the data bus means for at least one of the plurality of          the background to be covered by the object.
source addresses, and further comprising:                     13. A personal computer system in accordance with
   mask means, coupled between the receiving means 55 claim 12, in which the blitter means further comprises
      and the logic means, for masking a selected number shift means for executing a shift operation on bit
      of bits in the received multibit data word for at     mapped image data from at least one of the plurality of
      least one of the plurality of source addresses.       source addresses.
   7. A personal computer system in accordance with           14. A personal computer system in accordance with
claim 2, in which the blitter means further comprises 60 claim 1, in which the blitter means further comprises
shift means for executing a shift operation on bit means for selecting one of a plurality of logical opera
mapped image data from at least one of the three source tions, and in which the logic means executes the se
addresses.                                                  lected logical operation.
   8. A personal computer system in accordance with           15. A personal computer system in accordance with
claim 7, in which the blitter means further comprises 65 claim 14, and further comprising blitter DMA control
shift count means for selecting a shift count that deter ler means for generating a blitter DMA request to pre
mines the size of the shift to be executed on bit-mapped vent data from being transferred between the data bus
image data from at least one of the three source ad means and the central processor means at times when
                                                     4,874,164
                           37                                                              38
bit-mapped image data is transferred between the blitter        from the data bus means for at least one of the plurality
means and the memory means.                                     of source addresses, and further comprising:
   16. A personal computer system in accordance with              mask means, coupled between the receiving means
claim 14, wherein the image is assembled on the screen               and the logic means, for masking a selected number
by the electron beam scanning a plurality of horizontal             of bits in the received multibit data word for at
lines, and wherein the personal computer system further             least one of the plurality of source addresses.
comprises:                                                        24. A personal computer system in accordance with
   size means for designating the width of a window of          claim 1, and further comprising blitter DMA controller
     bit-mapped image data being processed by the blit          means for generating a blitter DMA request to prevent
    ter means, wherein the window width is the num 10 data from being transferred between the data bus means
    ber of addresses corresponding to each horizontal and the central processor means at times when bit
    line of the window; and                           mapped image data is transferred between the blitter
  modulo register means coupled to the pointer means means and the memory means.
    for storing a modulo amount, wherein the modulo        25. A personal system in accordance with claim 24,
    amount corresponds to the difference between the 15 wherein the image is assembled on the screen by the
    window width number and the number of ad             electron beam scanning a plurality of horizontal lines,
    dresses corresponding to each horizontal line of the and wherein the personal computer system further com
    image for at least one of the plurality of source           prises:
    addresses and the destination address; and                     size means for designating the width of a window of
  wherein the pointer means selects a first address cor 20          bit-mapped image data being processed by the blit
    responding to one horizontal line of the window,                ter means, wherein the window width is the num
    for at least one of the plurality of source addresses           ber of addresses corresponding to each horizontal
     and the destination address, by adding the modulo              line of the window; and
     amount to a last address corresponding to another            modulo register means coupled to the pointer means
     horizontal line of the window.                        25       for storing a modulo amount, wherein the modulo
   17. A personal computer system in accordance with                amount corresponds to the difference between the
claim 14, wherein the receiving means receives a multi              window width number and the number of ad
bit data word of unprocessed bit-mapped data from the               dresses corresponding to each horizontal line of the
data bus means for at least one of the plurality of source          image for at least one of the plurality of source
addresses, and further comprising:                         30       addresses and the destination address; and
   mask means, coupled between the receiving means                wherein the pointer means selects a first address cor
     and the logic means, for masking a selected number             responding to one horizontal line of the window,
    of bits in the received multi-bit data word for at              for at least one of the plurality of source addresses
     ieast one of the plurality of source addresses.                and the destination address, by adding the modulo
   18. A personal computer system in accordance with 35          amount to a last address corresponding to another
claim 14, in which the blitter means further comprises           horizontal line of the window.
shift means for executing a shift operation on bit             26. A personal computer system in accordance with
mapped image data from at least one of the plurality of claim 24, wherein the receiving means receives a multi
source addresses.                                           bit data word of unprocessed bit-mapped data from the
   19. A personal computer system in accordance with 40 data bus means for at least one of the plurality of source
claim 18, in which the blitter means further comprises addresses, and further comprising:
shift count means for selecting a shift count that deter       mask means, coupled between the receiving means
mines the size of the shift to be executed on bit-mapped         and the logic means, for masking a selected number
image data from at least one of the plurality of source          of bits in the received multibit data word for at
addresses, and in which the shift means executes the 45          least one of the plurality of source addresses.
selected shift count.                                          27. A personal computer system in accordance with
   20. A personal computer system in accordance with claim 1, in which the image display means generates
claim 1, in which the blitter means further comprises video output signals comprising RGB color signals.
shift means for executing a shift operation on bit             28. A personal computer system in accordance with
mapped image data from at least one of the plurality of 50 claim 1, wherein the image is assembled on the screen
Source addresses.                                           by the electron beam scanning a plurality of horizontal
   21. A personal computer system in accordance with lines, and wherein the personal computer system further
claim 20, in which the blitter means further comprises comprises:
shift count means for selecting a shift count that deter       size means for designating the width of a window of
mines the size of the shift to be executed on bit-mapped 55      bit-mapped image data being processed by the blit
image data from at least one of the plurality of source          ter means, wherein the window width is the num
addresses, and in which the shift means executes the             ber of addresses corresponding to each horizontal
selected shift count.                                            line of the window; and
   22. A personal computer system in accordance with           modulo register means coupled to the pointer means
claim 20, and further comprising blitter DMA control 60           for storing a modulo amount, wherein the modulo
ler means for generating a blitter DMA request to pre             amount corresponds to the difference between the
vent data from being transferred between the data bus             window width number and the number of ad
means and the central processor means at times when               dresses corresponding to each horizontal line of the
bit-mapped image data is transferred between the blitter          image for at least one of the plurality of source
means and the memory means.                              65       addresses and the destination address; and
   23. A personal computer system in accordance with           wherein the pointer means selects a first address cor
claim 20, wherein the receiving means receives a multi            responding to one horizontal line of the window,
bit data word of unprocessed bit-mapped image data                for at least one of the plurality of source addresses
                           39
                                                    4,874,164
                                                                                          40
     and the destination address, by adding the modulo            as a destination of processed bit-mapped image data
     amount to a last address corresponding to another            to be transferred on the data bus means;
     horizontal line of the window.                            blitter means, coupled to the data bus means, for
   29. A personal computer system in accordance with              transferring a block of bit-mapped image data be
claim 28, wherein the receiving means receives a multi            tween the blitter means and the memory means,
bit data word of unprocessed bit-mapped image data                and for processing the block of bit-mapped image
from the data bus means for at least one of the plurality        data, wherein the blitter means includes:
of source addresses, and further comprising:                    means for receiving from the data bus means un
   mask means, coupled between the receiving means O               processed bit-mapped image data stored in the
     and the logic means, for masking a selected number            memory means at the source address;
     of bits in the received multibit data word for at          logic means, for executing a logical operation on
     least one of the plurality of source addresses.               unprocessed bit-mapped image data to generate
   30. A personal computer system to provide video                 processes bit-mapped image data, wherein the
output signals to a raster display, wherein an image 15            logic means includes fill logic means, for detect
consisting of a plurality of pixels is assembled on a              ing bit-mapped image data corresponding to
screen of the raster display by an electron beam scan              each of the two vertical lines during processing
ning the screen, wherein the visual characteristics of a           of bit-mapped image data corresponding to one
pixel being scanned by the electron beam are deter                 horizontal line of the image, and for changing
mined by the video output signals provided by the per 20           bit-mapped    image data corresponding to the
sonal computer system when the pixel is being scanned,             region  of the  one horizontal line bounded by the
                                                                   two vertical lines in order to fill the bounded
and wherein the image includes a region bounded by                 region; and
two vertical lines, and wherein the personal computer           means    for providing the processed bit-mapped
system comprises:                                                  image  data to the data bus means for storage in
  central processor means for executing program in 25              the  memory     means at the destination address;
     structions;                                                   and
  memory means including a plurality of addresses for        image display means, for receiving bit-mapped image
     storing bit-mapped image data, wherein the visual         data stored in at least one address corresponding to
     characteristics of a pixel are defined by bit-mapped       a pixel, and for generating the video output signals.
     image data stored in at least one address corre 30 31. A personal computer system in accordance with
     sponding to the pixel;                               claim 30, in which the blitter means further comprises
  data bus means coupled to the processor means and shift        means for executing as shift operation on bit
     the memory means for transferring data;              mapped image data from the source address.
  address bus means coupled to the processor means           32. A personal computer system in accordance with
     and the memory means for transferring an address 35 claim 30, and further comprising blitter DMA control
     to the memory means;                                 ler means for generating a blitter DMA request to pre
  pointer means, coupled to the address bus means, for vent data from being transferred between the data bus
     selecting a source address in the memory means as means and the central processor means at times when
     a source of unprocessed bit-mapped image data to bit-mapped image data is transferred between the blitter
     be transferred on the data bus means, and for se means and the memory means.
     lecting a destination address in the memory means                            ck ck  xk  ck sk




                                                         45




                                                         50




                                                         55




                                                         60




                                                         65
                                                                                          US004874164C1

       (12) EX PARTE REEXAMINATION CERTIFICATE (6059th)
United States Patent                                                   (10) Number:          US 4.874,164 C1
Miner et al.                                                           (45) Certificate Issued:  Dec. 25, 2007

(54) PERSONAL COMPUTER APPARATUS FOR                                       4,180,855. A    12/1979 Buedel
        BLOCK TRANSFER OF BIT MAPPED                                       4,243,984 A     1/1981 Ackley et al.
        IMAGE DATA                                                         RE31,200 E      4, 1983 Sukonicket al.
                                                                           4,535,420 A     8/1985 Fung
(75) Inventors: Jay G. Miner, Mtn. View, CA (US);                          4,555,775 A     11/1985 Pike
                      Dave Dean, Ukiah, CA (US); Joseph
                      C. Decuir, Albany, CA (US); Ronald                              OTHER PUBLICATIONS
                      H. Nicholson, Sunnyvale, CA (US);
                      Akio Tanaka, Burlingame, CA (US)              Pike, R. “Graphics in Overlapping Bitmap Layers. Com
(73) Assignee: AD Technologies LLC, North Sioux                     puter Graphics, vol. 17, No. 3 (1983).
               City, SD (US)                                        Foley & Van Dam, Fundamentals of Interactive Computer
Reexamination Request:                                              Graphics (1982), Addison Wesley Publishing Company,
     No. 90/007,667, Aug. 12, 2005                                  United States.

Reexamination Certificate for:
        Patent No.:        4,874,164                                Primary Examiner Albert Gagliardi
        Issued:            Oct. 17, 1989                            (57)                    ABSTRACT
        Appl. No.:         06/886,796
        Filed:             Jul. 18, 1986                            A computer that provides data to a video display using a
(51) Int. Cl.                                                       bitmap display memory organization and bitplane address
        G09G 5/37              (2006.01)                            ing. Separate control is provided for two bit-plane back
        G09G 5/39              (2006.01)                            grounds and for eight reusable and easily movable sprites.
        G09G 5/36              (2006.01)                            Additional logic allows for dynamically-controllable inter
        A63F I3/00             (2006.01)                            object priority and collision detection among data in each of
                                                                    the bitplane backgrounds and sprites. A coprocessor pro
(52) U.S. Cl. ........................ 345/562: 345/545; 34.5/564   vides for video beam-synchronized changes to data in
(58) Field of Classification Search ................. 345/562,      registers, freeing the main processor for general purpose
                                                  345/545,564       computing tasks. A block image transfer is provided to
        See application file for complete search history.
                                                                    rapidly copy data in large blocks from one memory location
(56)                    References Cited                            to another. In hold-and-modify mode, color output circuitry
                  U.S. PATENT DOCUMENTS
                                                                    holds the value for a previously displayed pixel while
                                                                    bitplane data modifies those values, allowing for simulta
       3,955,212 A       5/1976 Engel et al.                        neous display of a greatly increased number of colors.




                                                           T
                                                                    r
                                               FLLENABE
                                                                     3. s
                                                 SORETO
                                               DESKAON
                            US 4,874,164 C1
               1.                                                  2
        EX PARTE                       AS A RESULT OF REEXAMINATION, IT HAS BEEN
REEXAMINATION CERTIFICATE                DETERMINED THAT:
 ISSUED UNDER 35 U.S.C. 307        5    The patentability of claims 1-32 is confirmed.
NO AMENDMENTS HAVE BEEN MADE TO
          THE PATENT                                       k   .   .   .   .
